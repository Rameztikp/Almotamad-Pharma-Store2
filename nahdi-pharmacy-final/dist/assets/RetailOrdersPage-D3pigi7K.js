import{r as x,j as s,ay as as,aA as Ss}from"./index--DLPBvsr.js";import{B as ks,O as Cs,Y as Fs,R as is,F as Ds,X as Ls}from"./index-BjbvdVW9.js";import{a as y}from"./orderService-DI294Tq1.js";import{y as p}from"./index-H9pn8gH5.js";const Es=()=>{var z,J,q,R,$,G,Q,X,Y,H,K,V,W,Z,U,O,ss;const[m,ns]=x.useState(""),[C,F]=x.useState([]),[D,b]=x.useState(!0),[r,v]=x.useState(1),[j,L]=x.useState(1),[u,ls]=x.useState({status:"",order_type:"retail"}),[cs,M]=x.useState(!1),[n,P]=x.useState(null),[rs,w]=x.useState(!1),[t,_]=x.useState(null),h=async(e=1,a="")=>{try{b(!0);const i=await y.getAllOrders({page:e,limit:10,status:u.status,order_type:"retail",search:a});F(i.orders||[]),L(i.totalPages||1),v(e)}catch(i){console.error("Error fetching retail orders:",i),p.error("فشل في تحميل طلبات التجزئة")}finally{b(!1)}},xs=(e={})=>e.address_line1||e.addressLine1||e.AddressLine1||e.address1||e.line1||e.address||e.Address||e.street||e.street_name||e.streetName||e.street_address||e.streetAddress||e.street_ar||e.street_name_ar||e.address_line2||"",ms=(e={})=>e.district||e.neighborhood||e.neighbourhood||e.neighborhood_ar||e.district_ar||e.area||e.area_name||"",ds=(e={})=>e.city||e.City||e.city_ar||e.municipality||"",os=e=>{var a,i,c,l,d,o,g;return((a=e.shippingAddress)==null?void 0:a.full_name)||((i=e.shippingAddress)==null?void 0:i.name)||((c=e.shipping_address)==null?void 0:c.full_name)||((l=e.shipping_address)==null?void 0:l.name)||e.customerName||((d=e.user)==null?void 0:d.full_name)||((o=e.user)==null?void 0:o.name)||((g=e.user)==null?void 0:g.email)||"عميل"},hs=e=>{P(e||null),M(!0)},A=()=>{M(!1),P(null)},ps=e=>{_(e||null),w(!0);try{const a=(e==null?void 0:e.shippingAddress)||(e==null?void 0:e.shipping_address),i=(e==null?void 0:e.billingAddress)||(e==null?void 0:e.billing_address);console.log("[Invoice] shippingAddress JSON:",a?JSON.stringify(a,null,2):null),console.log("[Invoice] billingAddress JSON:",i?JSON.stringify(i,null,2):null)}catch{}},T=()=>{w(!1),_(null)},us=async e=>{const a=(e==null?void 0:e._id)||(e==null?void 0:e.id);if(!a){console.error("handleAccept: missing order id"),p.error("تعذر تحديد رقم الطلب");return}try{await y.updateOrderStatus(a,"processing","retail"),p.success("تم قبول الطلب وتحويله إلى قيد التجهيز");let i=null;try{i=await y.getOrderDetails(a,"retail")}catch(l){console.warn("Failed to fetch latest order details, falling back to local order:",(l==null?void 0:l.message)||l)}const c=i?{...i}:{...e,status:"processing",_id:e._id||void 0,id:e.id||void 0};_(c),w(!0);try{await y.notifyCustomer(a,{event:"order_processing",message:"طلبك قيد التجهيز"})}catch(l){console.warn("Notify customer failed (non-blocking):",(l==null?void 0:l.message)||l)}setTimeout(()=>{try{window.print()}catch{}},300),h(r,m)}catch(i){console.error("Error accepting order:",i),p.error("فشل قبول الطلب")}};x.useEffect(()=>{h(1,m)},[u.status]);const S=async(e,a)=>{try{await y.updateOrderStatus(e,a,"retail"),p.success("تم تحديث حالة الطلب بنجاح"),h(r,m)}catch(i){console.error("Error updating order status:",i),p.error("فشل في تحديث حالة الطلب")}},B=e=>{const a=new Date(e);return isNaN(a.getTime())?"—":a.toLocaleDateString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit"})},f=e=>{const a=typeof e=="string"?parseFloat(e):typeof e=="number"?e:0;return isNaN(a)?0:a},E=e=>{var i,c;const a=e.price??e.unit_price??e.unitPrice??e.sale_price??e.salePrice??((i=e.product)==null?void 0:i.sale_price)??((c=e.product)==null?void 0:c.price)??0;return f(a)},k=e=>{const a=e.quantity??e.qty??0;return f(a)},I=(e=[],a=null)=>{if(a){const c=a.total_amount??a.totalAmount??a.total??null;if(c!=null&&!isNaN(f(c)))return f(c)}const i=(Array.isArray(e)?e:[]).reduce((c,l)=>c+E(l)*k(l),0);return f(i)},gs=e=>{const a=(e==null?void 0:e.shippingAddress)||(e==null?void 0:e.shipping_address)||(e==null?void 0:e.ShippingAddress)||(e==null?void 0:e.shipping)||(e==null?void 0:e.address)||(e==null?void 0:e.billingAddress)||(e==null?void 0:e.billing_address)||{},i=a.address||a.full_address||a.fullAddress;if(i&&typeof i=="string")return i;const c=a.address_line1||a.addressLine1||a.AddressLine1||a.address1||a.line1||a.street||a.street_name||a.streetName||a.street_ar||a.street_name_ar||"",l=a.address_line2||a.addressLine2||a.AddressLine2||a.address2||a.line2||a.apartment||a.unit||a.flat||"",d=a.district||a.neighborhood||a.neighbourhood||a.neighborhood_ar||a.district_ar||a.area||a.area_name||"",o=a.building_no||a.building||"",g=a.additional_no||a.additionalNumber||"",Ns=a.landmark||"",bs=a.city||"",vs=a.state||a.region||a.province||"",ws=a.postal_code||a.postalCode||a.zip||a.zipCode||"",_s=a.country||"",As=[c,l,d,o,g,Ns,bs,vs,ws,_s].map(N=>typeof N=="string"?N.trim():"").filter(Boolean),es=new Set,ts=As.filter(N=>es.has(N)?!1:(es.add(N),!0));return ts.length?ts.join("، "):"—"};x.useEffect(()=>{(async()=>{try{b(!0);const a=await y.getAllOrders({page:r,limit:10,status:u.status,order_type:"retail",search:m});F(a.orders||[]),L(a.totalPages||1)}catch(a){console.error("Error fetching orders:",a),p.error("حدث خطأ في جلب الطلبات")}finally{b(!1)}})()},[r,u.status,m]);const ys=e=>{e.preventDefault(),v(1)},js=e=>{const a=e.target.value;ls({...u,status:a}),v(1)},fs=e=>{const a=Ss(e);return s.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${a}`,children:as(e)})};return s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"إدارة طلبات القطاعي"}),s.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mt-4 md:mt-0",children:[s.jsx("div",{className:"relative",children:s.jsxs("select",{className:"block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",value:u.status,onChange:js,children:[s.jsx("option",{value:"",children:"جميع الحالات"}),s.jsx("option",{value:"pending",children:"قيد الانتظار"}),s.jsx("option",{value:"processing",children:"قيد التجهيز"}),s.jsx("option",{value:"shipped",children:"تم الشحن"}),s.jsx("option",{value:"delivered",children:"تم التسليم"}),s.jsx("option",{value:"cancelled",children:"تم الإلغاء"})]})}),s.jsxs("form",{onSubmit:ys,className:"relative flex-1",children:[s.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:s.jsx(ks,{className:"text-gray-400"})}),s.jsx("input",{type:"text",className:"w-full md:w-64 pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"ابحث برقم الطلب أو اسم العميل",value:m,onChange:e=>ns(e.target.value)})]})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden border border-gray-200",children:[s.jsx("div",{className:"overflow-x-auto",children:D?s.jsxs("div",{className:"flex justify-center items-center p-12",children:[s.jsx(Cs,{className:"animate-spin text-blue-500 text-2xl mr-3"}),s.jsx("span",{className:"text-gray-600",children:"جاري تحميل الطلبات..."})]}):C.length===0?s.jsxs("div",{className:"text-center p-12",children:[s.jsx(Fs,{className:"mx-auto h-12 w-12 text-gray-400"}),s.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"لا توجد طلبات"}),s.jsx("p",{className:"mt-1 text-gray-500",children:"لم يتم العثور على أي طلبات متطابقة مع معايير البحث"})]}):s.jsx("div",{className:"align-middle min-w-full overflow-x-auto",children:s.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-32",children:s.jsx("div",{className:"flex items-center justify-end",children:s.jsx("span",{children:"رقم الطلب"})})}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-48",children:s.jsx("div",{className:"flex items-center justify-end",children:s.jsx("span",{children:"العميل"})})}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-32",children:s.jsx("div",{className:"flex items-center justify-end",children:s.jsx("span",{children:"التاريخ"})})}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-32",children:s.jsx("div",{className:"flex items-center justify-end",children:s.jsx("span",{children:"المجموع"})})}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-40",children:s.jsx("div",{className:"flex items-center justify-end",children:s.jsx("span",{children:"المنتجات"})})}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-32",children:s.jsx("div",{className:"flex items-center justify-end",children:s.jsx("span",{children:"طريقة الدفع"})})}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-36",children:s.jsx("div",{className:"flex items-center justify-end",children:s.jsx("span",{children:"الحالة"})})}),s.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-40",children:s.jsx("span",{className:"sr-only",children:"الإجراءات"})})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:C.map(e=>{var a,i,c,l,d;return s.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("div",{className:"flex items-center justify-end",children:s.jsxs("button",{type:"button",className:"text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline",onClick:()=>ps(e),title:"عرض الفاتورة",children:["#",e.orderNumber||((a=e._id)==null?void 0:a.substring(0,8).toUpperCase())]})})}),s.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[s.jsx("div",{className:"flex items-center justify-end",children:s.jsx("button",{type:"button",className:"text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline",onClick:()=>hs(e.user),title:"عرض تفاصيل العميل",children:os(e)})}),(((i=e.user)==null?void 0:i.phone)||((c=e.shippingAddress)==null?void 0:c.phone))&&s.jsx("div",{className:"text-sm text-gray-500 mt-1 text-left",children:((l=e.user)==null?void 0:l.phone)||((d=e.shippingAddress)==null?void 0:d.phone)})]}),s.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[s.jsx("div",{className:"text-sm text-gray-900 text-right",children:B(e.createdAt)}),s.jsx("div",{className:"text-sm text-gray-500 text-right",children:new Date(e.createdAt).toLocaleTimeString("ar-SA")})]}),s.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[I(e.items,e).toLocaleString("ar-SA",{minimumFractionDigits:2,maximumFractionDigits:2})," ر.س"]}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsxs("div",{className:"flex flex-col items-end",children:[s.jsxs("span",{className:"text-sm text-gray-900",children:[(e.items||[]).length," منتج"]}),s.jsxs("span",{className:"text-xs text-gray-500 mt-1",children:[(e.items||[]).reduce((o,g)=>o+k(g),0)," قطعة"]})]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("div",{className:"flex items-center justify-end",children:s.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${e.paymentMethod==="cod"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:e.paymentMethod==="cod"?"الدفع عند الاستلام":"بطاقة ائتمان"})})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("div",{className:"flex items-center justify-end",children:fs(e.status)})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:s.jsxs("div",{className:"flex items-center justify-end space-x-3 space-x-reverse",children:[e.status==="pending"&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:()=>us(e),className:"px-3 py-1.5 text-blue-600 hover:bg-blue-50 rounded-full transition-colors flex items-center gap-1",title:"قبول الطلب",children:[s.jsx(is,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm",children:"قبول"})]}),s.jsxs("button",{className:"px-3 py-1.5 text-red-600 hover:bg-red-50 rounded-full transition-colors flex items-center gap-1",onClick:()=>S(e._id||e.id,"cancelled"),title:"إلغاء الطلب",children:[s.jsx(Ds,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm",children:"إلغاء"})]})]}),e.status==="processing"&&s.jsx("button",{className:"p-2 text-indigo-600 hover:bg-indigo-50 rounded-full transition-colors",onClick:()=>S(e._id||e.id,"shipped"),title:"تم شحن الطلب",children:s.jsx(Ls,{className:"w-4 h-4"})}),e.status==="shipped"&&s.jsx("button",{className:"p-2 text-green-600 hover:bg-green-50 rounded-full transition-colors",onClick:()=>S(e._id||e.id,"delivered"),title:"تأكيد الاستلام",children:s.jsx(is,{className:"w-4 h-4"})})]})})]},e.id||e._id||e.orderNumber)})})]})})}),!D&&j>1&&s.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[s.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[s.jsx("button",{onClick:()=>r>1&&h(r-1,m),disabled:r===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"السابق"}),s.jsx("button",{onClick:()=>r<j&&h(r+1,m),disabled:r===j,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"التالي"})]}),s.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[s.jsx("div",{children:s.jsxs("p",{className:"text-sm text-gray-700",children:["صفحة ",s.jsx("span",{className:"font-medium",children:r})," من ",s.jsx("span",{className:"font-medium",children:j})]})}),s.jsx("div",{children:s.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",dir:"ltr",children:[s.jsxs("button",{onClick:()=>h(r-1,m),disabled:r===1,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50",children:[s.jsx("span",{className:"sr-only",children:"السابق"}),"←"]}),s.jsx("span",{className:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700",children:r}),s.jsxs("button",{onClick:()=>h(r+1,m),disabled:r===j,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50",children:[s.jsx("span",{className:"sr-only",children:"التالي"}),"→"]})]})})]})]})]}),cs&&s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:A}),s.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl w-full max-w-md mx-4 p-6 z-10",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"تفاصيل العميل"}),s.jsx("button",{onClick:A,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"الاسم:"}),s.jsx("span",{className:"font-medium text-gray-900",children:(n==null?void 0:n.full_name)||(n==null?void 0:n.name)||(n==null?void 0:n.email)||"غير متوفر"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"البريد الإلكتروني:"}),s.jsx("span",{className:"font-medium text-gray-900",children:(n==null?void 0:n.email)||"غير متوفر"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"رقم الجوال:"}),s.jsx("span",{className:"font-medium text-gray-900",children:(n==null?void 0:n.phone)||"غير متوفر"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"نوع الحساب:"}),s.jsx("span",{className:"font-medium text-gray-900",children:(n==null?void 0:n.account_type)==="wholesale"?"جملة":"تجزئة"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"ترقية حساب جملة:"}),s.jsx("span",{className:`px-2 py-0.5 text-xs rounded-full ${n!=null&&n.wholesale_access?"bg-green-100 text-green-800":"bg-gray-100 text-gray-700"}`,children:n!=null&&n.wholesale_access?"مفعل":"غير مفعل"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"تاريخ الميلاد:"}),s.jsx("span",{className:"font-medium text-gray-900",children:n!=null&&n.date_of_birth?new Date(n.date_of_birth).toLocaleDateString("ar-SA"):"غير متوفر"})]})]}),s.jsx("div",{className:"mt-6 text-left",children:s.jsx("button",{onClick:A,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"إغلاق"})})]})]}),rs&&s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:T}),s.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl w-full max-w-4xl mx-4 p-6 z-10",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["فاتورة الطلب #",(t==null?void 0:t.orderNumber)||((J=(z=t==null?void 0:t._id)==null?void 0:z.substring(0,8))==null?void 0:J.toUpperCase())]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>window.print(),className:"px-3 py-1.5 bg-gray-100 text-gray-700 rounded hover:bg-gray-200",children:"طباعة"}),s.jsx("button",{onClick:T,className:"px-3 py-1.5 bg-blue-600 text-white rounded hover:bg-blue-700",children:"إغلاق"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"بيانات الشحن"}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"اسم الشحن:"}),s.jsx("span",{className:"font-medium text-gray-900 text-left",children:((q=t==null?void 0:t.shippingAddress)==null?void 0:q.full_name)||((R=t==null?void 0:t.shippingAddress)==null?void 0:R.name)||(($=t==null?void 0:t.shipping_address)==null?void 0:$.full_name)||((G=t==null?void 0:t.shipping_address)==null?void 0:G.name)||[(Q=t==null?void 0:t.shippingAddress)==null?void 0:Q.first_name,(X=t==null?void 0:t.shippingAddress)==null?void 0:X.last_name].filter(Boolean).join(" ")||[(Y=t==null?void 0:t.shipping_address)==null?void 0:Y.first_name,(H=t==null?void 0:t.shipping_address)==null?void 0:H.last_name].filter(Boolean).join(" ")||"—"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"البريد الإلكتروني:"}),s.jsx("span",{className:"font-medium text-gray-900",children:((K=t==null?void 0:t.shippingAddress)==null?void 0:K.email)||((V=t==null?void 0:t.shipping_address)==null?void 0:V.email)||((W=t==null?void 0:t.user)==null?void 0:W.email)||"—"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"جوال الشحن:"}),s.jsx("span",{className:"font-medium text-gray-900 text-left",children:((Z=t==null?void 0:t.shippingAddress)==null?void 0:Z.phone)||((U=t==null?void 0:t.shipping_address)==null?void 0:U.phone)||"—"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"العنوان:"}),s.jsx("span",{className:"font-medium text-gray-900 text-left",children:gs(t)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"الشارع:"}),s.jsx("span",{className:"font-medium text-gray-900 text-left",children:xs((t==null?void 0:t.shippingAddress)||(t==null?void 0:t.shipping_address)||(t==null?void 0:t.billingAddress)||(t==null?void 0:t.billing_address)||{})||"غير متوفر"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"المدينة:"}),s.jsx("span",{className:"font-medium text-gray-900 text-left",children:ds((t==null?void 0:t.shippingAddress)||(t==null?void 0:t.shipping_address)||(t==null?void 0:t.billingAddress)||(t==null?void 0:t.billing_address)||{})||"غير متوفر"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"الحي:"}),s.jsx("span",{className:"font-medium text-gray-900 text-left",children:ms((t==null?void 0:t.shippingAddress)||(t==null?void 0:t.shipping_address)||(t==null?void 0:t.billingAddress)||(t==null?void 0:t.billing_address)||{})||"—"})]}),s.jsxs("details",{className:"mt-2 select-text",children:[s.jsx("summary",{className:"cursor-pointer text-xs text-gray-500",children:"تفاصيل العنوان (Debug)"}),s.jsxs("div",{className:"mt-1 grid grid-cols-1 gap-2",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-[11px] text-gray-500",children:"Shipping Address"}),s.jsx("pre",{className:"text-[11px] bg-gray-50 p-2 rounded border overflow-auto max-h-40",children:JSON.stringify((t==null?void 0:t.shippingAddress)||(t==null?void 0:t.shipping_address)||{},null,2)})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-[11px] text-gray-500",children:"Billing Address"}),s.jsx("pre",{className:"text-[11px] bg-gray-50 p-2 rounded border overflow-auto max-h-40",children:JSON.stringify((t==null?void 0:t.billingAddress)||(t==null?void 0:t.billing_address)||{},null,2)})]})]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"بيانات الطلب"}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"التاريخ:"}),s.jsx("span",{className:"font-medium text-gray-900",children:t!=null&&t.createdAt?B(t.createdAt):"—"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"الحالة:"}),s.jsx("span",{className:"font-medium text-gray-900",children:as(t==null?void 0:t.status)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"طريقة الدفع:"}),s.jsx("span",{className:"font-medium text-gray-900",children:(t==null?void 0:t.paymentMethod)==="cod"?"الدفع عند الاستلام":"بطاقة ائتمان"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"رقم الطلب:"}),s.jsx("span",{className:"font-medium text-gray-900",children:(t==null?void 0:t.orderNumber)||((ss=(O=t==null?void 0:t._id)==null?void 0:O.substring(0,8))==null?void 0:ss.toUpperCase())})]})]})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"المنتج"}),s.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"السعر للوحدة"}),s.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"الكمية"}),s.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"الإجمالي"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:((t==null?void 0:t.items)||[]).map((e,a)=>{var o;const i=((o=e.product)==null?void 0:o.name)||e.name||`منتج ${a+1}`,c=E(e),l=k(e),d=c*l;return s.jsxs("tr",{children:[s.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:i}),s.jsxs("td",{className:"px-4 py-2 text-sm text-gray-900",children:[c.toLocaleString("ar-SA",{minimumFractionDigits:2,maximumFractionDigits:2})," ر.س"]}),s.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:l}),s.jsxs("td",{className:"px-4 py-2 text-sm text-gray-900",children:[d.toLocaleString("ar-SA",{minimumFractionDigits:2,maximumFractionDigits:2})," ر.س"]})]},e.id||e._id||a)})})]})}),s.jsx("div",{className:"mt-4 flex items-center justify-end",children:s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-sm text-gray-600",children:"إجمالي الفاتورة"}),s.jsxs("div",{className:"text-xl font-bold text-gray-900",children:[I(t==null?void 0:t.items,t).toLocaleString("ar-SA",{minimumFractionDigits:2,maximumFractionDigits:2})," ر.س"]})]})})]})]})]})};export{Es as default};
