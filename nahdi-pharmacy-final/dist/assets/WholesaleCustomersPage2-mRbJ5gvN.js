import{a4 as ls,Q as he,l as X,P as xe,j as e,a5 as Se,r,a6 as $e,a7 as ee,U as H,a8 as qe,a9 as is,aa as cs,a2 as K,ab as ds,ac as us,ad as ms,ae as xs,af as fs,ag as hs,B as Q,ah as We,ai as ps,a as gs,aj as J,ak as bs,I as vs,al as js,am as ce,an as de,c as Ie,d as Ae,e as ke,f as Re,C as Ns,ao as ue,ap as ae,aq as ys,ar as Ee,as as Le,at as ws}from"./index-ocCBIm11.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],re=ls("refresh-cw",Cs);function _s(t){const a=t+"CollectionProvider",[u,o]=he(a),[g,f]=u(a,{collectionRef:{current:null},itemMap:new Map}),h=S=>{const{scope:d,children:m}=S,I=X.useRef(null),x=X.useRef(new Map).current;return e.jsx(g,{scope:d,itemMap:x,collectionRef:I,children:m})};h.displayName=a;const T=t+"CollectionSlot",R=Se(T),k=X.forwardRef((S,d)=>{const{scope:m,children:I}=S,x=f(T,m),w=xe(d,x.collectionRef);return e.jsx(R,{ref:w,children:I})});k.displayName=T;const c=t+"CollectionItemSlot",b="data-radix-collection-item",E=Se(c),$=X.forwardRef((S,d)=>{const{scope:m,children:I,...x}=S,w=X.useRef(null),B=xe(d,w),F=f(c,m);return X.useEffect(()=>(F.itemMap.set(w,{ref:w,...x}),()=>void F.itemMap.delete(w))),e.jsx(E,{[b]:"",ref:B,children:I})});$.displayName=c;function V(S){const d=f(t+"CollectionConsumer",S);return X.useCallback(()=>{const I=d.collectionRef.current;if(!I)return[];const x=Array.from(I.querySelectorAll(`[${b}]`));return Array.from(d.itemMap.values()).sort((F,p)=>x.indexOf(F.ref.current)-x.indexOf(p.ref.current))},[d.collectionRef,d.itemMap])}return[{Provider:h,Slot:k,ItemSlot:$},V,o]}var Ts=r.createContext(void 0);function Ve(t){const a=r.useContext(Ts);return t||a||"ltr"}var me="rovingFocusGroup.onEntryFocus",Ss={bubbles:!1,cancelable:!0},te="RovingFocusGroup",[fe,Ge,Is]=_s(te),[As,Ke]=he(te,[Is]),[ks,Rs]=As(te),Be=r.forwardRef((t,a)=>e.jsx(fe.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(fe.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(Es,{...t,ref:a})})}));Be.displayName=te;var Es=r.forwardRef((t,a)=>{const{__scopeRovingFocusGroup:u,orientation:o,loop:g=!1,dir:f,currentTabStopId:h,defaultCurrentTabStopId:T,onCurrentTabStopIdChange:R,onEntryFocus:k,preventScrollOnEntryFocus:c=!1,...b}=t,E=r.useRef(null),$=xe(a,E),V=Ve(f),[S,d]=qe({prop:h,defaultProp:T??null,onChange:R,caller:te}),[m,I]=r.useState(!1),x=is(k),w=Ge(u),B=r.useRef(!1),[F,p]=r.useState(0);return r.useEffect(()=>{const L=E.current;if(L)return L.addEventListener(me,x),()=>L.removeEventListener(me,x)},[x]),e.jsx(ks,{scope:u,orientation:o,dir:V,loop:g,currentTabStopId:S,onItemFocus:r.useCallback(L=>d(L),[d]),onItemShiftTab:r.useCallback(()=>I(!0),[]),onFocusableItemAdd:r.useCallback(()=>p(L=>L+1),[]),onFocusableItemRemove:r.useCallback(()=>p(L=>L-1),[]),children:e.jsx(ee.div,{tabIndex:m||F===0?-1:0,"data-orientation":o,...b,ref:$,style:{outline:"none",...t.style},onMouseDown:H(t.onMouseDown,()=>{B.current=!0}),onFocus:H(t.onFocus,L=>{const Z=!B.current;if(L.target===L.currentTarget&&Z&&!m){const N=new CustomEvent(me,Ss);if(L.currentTarget.dispatchEvent(N),!N.defaultPrevented){const se=w().filter(U=>U.focusable),oe=se.find(U=>U.active),le=se.find(U=>U.id===S),ie=[oe,le,...se].filter(Boolean).map(U=>U.ref.current);He(ie,c)}}B.current=!1}),onBlur:H(t.onBlur,()=>I(!1))})})}),Ue="RovingFocusGroupItem",ze=r.forwardRef((t,a)=>{const{__scopeRovingFocusGroup:u,focusable:o=!0,active:g=!1,tabStopId:f,children:h,...T}=t,R=$e(),k=f||R,c=Rs(Ue,u),b=c.currentTabStopId===k,E=Ge(u),{onFocusableItemAdd:$,onFocusableItemRemove:V,currentTabStopId:S}=c;return r.useEffect(()=>{if(o)return $(),()=>V()},[o,$,V]),e.jsx(fe.ItemSlot,{scope:u,id:k,focusable:o,active:g,children:e.jsx(ee.span,{tabIndex:b?0:-1,"data-orientation":c.orientation,...T,ref:a,onMouseDown:H(t.onMouseDown,d=>{o?c.onItemFocus(k):d.preventDefault()}),onFocus:H(t.onFocus,()=>c.onItemFocus(k)),onKeyDown:H(t.onKeyDown,d=>{if(d.key==="Tab"&&d.shiftKey){c.onItemShiftTab();return}if(d.target!==d.currentTarget)return;const m=Fs(d,c.orientation,c.dir);if(m!==void 0){if(d.metaKey||d.ctrlKey||d.altKey||d.shiftKey)return;d.preventDefault();let x=E().filter(w=>w.focusable).map(w=>w.ref.current);if(m==="last")x.reverse();else if(m==="prev"||m==="next"){m==="prev"&&x.reverse();const w=x.indexOf(d.currentTarget);x=c.loop?Ms(x,w+1):x.slice(w+1)}setTimeout(()=>He(x))}}),children:typeof h=="function"?h({isCurrentTabStop:b,hasTabStop:S!=null}):h})})});ze.displayName=Ue;var Ls={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Ds(t,a){return a!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function Fs(t,a,u){const o=Ds(t.key,u);if(!(a==="vertical"&&["ArrowLeft","ArrowRight"].includes(o))&&!(a==="horizontal"&&["ArrowUp","ArrowDown"].includes(o)))return Ls[o]}function He(t,a=!1){const u=document.activeElement;for(const o of t)if(o===u||(o.focus({preventScroll:a}),document.activeElement!==u))return}function Ms(t,a){return t.map((u,o)=>t[(a+o)%t.length])}var Ps=Be,Os=ze,ne="Tabs",[$s,Ys]=he(ne,[Ke]),Ye=Ke(),[qs,pe]=$s(ne),Qe=r.forwardRef((t,a)=>{const{__scopeTabs:u,value:o,onValueChange:g,defaultValue:f,orientation:h="horizontal",dir:T,activationMode:R="automatic",...k}=t,c=Ve(T),[b,E]=qe({prop:o,onChange:g,defaultProp:f??"",caller:ne});return e.jsx(qs,{scope:u,baseId:$e(),value:b,onValueChange:E,orientation:h,dir:c,activationMode:R,children:e.jsx(ee.div,{dir:c,"data-orientation":h,...k,ref:a})})});Qe.displayName=ne;var Xe="TabsList",Je=r.forwardRef((t,a)=>{const{__scopeTabs:u,loop:o=!0,...g}=t,f=pe(Xe,u),h=Ye(u);return e.jsx(Ps,{asChild:!0,...h,orientation:f.orientation,dir:f.dir,loop:o,children:e.jsx(ee.div,{role:"tablist","aria-orientation":f.orientation,...g,ref:a})})});Je.displayName=Xe;var Ze="TabsTrigger",es=r.forwardRef((t,a)=>{const{__scopeTabs:u,value:o,disabled:g=!1,...f}=t,h=pe(Ze,u),T=Ye(u),R=as(h.baseId,o),k=rs(h.baseId,o),c=o===h.value;return e.jsx(Os,{asChild:!0,...T,focusable:!g,active:c,children:e.jsx(ee.button,{type:"button",role:"tab","aria-selected":c,"aria-controls":k,"data-state":c?"active":"inactive","data-disabled":g?"":void 0,disabled:g,id:R,...f,ref:a,onMouseDown:H(t.onMouseDown,b=>{!g&&b.button===0&&b.ctrlKey===!1?h.onValueChange(o):b.preventDefault()}),onKeyDown:H(t.onKeyDown,b=>{[" ","Enter"].includes(b.key)&&h.onValueChange(o)}),onFocus:H(t.onFocus,()=>{const b=h.activationMode!=="manual";!c&&!g&&b&&h.onValueChange(o)})})})});es.displayName=Ze;var ss="TabsContent",ts=r.forwardRef((t,a)=>{const{__scopeTabs:u,value:o,forceMount:g,children:f,...h}=t,T=pe(ss,u),R=as(T.baseId,o),k=rs(T.baseId,o),c=o===T.value,b=r.useRef(c);return r.useEffect(()=>{const E=requestAnimationFrame(()=>b.current=!1);return()=>cancelAnimationFrame(E)},[]),e.jsx(cs,{present:g||c,children:({present:E})=>e.jsx(ee.div,{"data-state":c?"active":"inactive","data-orientation":T.orientation,role:"tabpanel","aria-labelledby":R,hidden:!E,id:k,tabIndex:0,...h,ref:a,style:{...t.style,animationDuration:b.current?"0s":void 0},children:E&&f})})});ts.displayName=ss;function as(t,a){return`${t}-trigger-${a}`}function rs(t,a){return`${t}-content-${a}`}var Ws=Qe,Vs=Je,Gs=es,Ks=ts;function Bs({className:t,...a}){return e.jsx(Ws,{"data-slot":"tabs",className:K("flex flex-col gap-2",t),...a})}function Us({className:t,...a}){return e.jsx(Vs,{"data-slot":"tabs-list",className:K("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...a})}function De({className:t,...a}){return e.jsx(Gs,{"data-slot":"tabs-trigger",className:K("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...a})}function Fe({className:t,...a}){return e.jsx(Ks,{"data-slot":"tabs-content",className:K("flex-1 outline-none",t),...a})}function Me({className:t,...a}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:K("w-full caption-bottom text-sm",t),...a})})}function Pe({className:t,...a}){return e.jsx("thead",{"data-slot":"table-header",className:K("[&_tr]:border-b",t),...a})}function Oe({className:t,...a}){return e.jsx("tbody",{"data-slot":"table-body",className:K("[&_tr:last-child]:border-0",t),...a})}function Y({className:t,...a}){return e.jsx("tr",{"data-slot":"table-row",className:K("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...a})}function W({className:t,...a}){return e.jsx("th",{"data-slot":"table-head",className:K("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function D({className:t,...a}){return e.jsx("td",{"data-slot":"table-cell",className:K("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}const zs=({isOpen:t,onClose:a,onConfirm:u,customerName:o,companyName:g,isLoading:f=!1})=>e.jsx(ds,{open:t,onOpenChange:a,children:e.jsxs(us,{className:"sm:max-w-md bg-white border border-gray-200 shadow-lg","aria-describedby":"approval-description approval-details",children:[e.jsx(ms,{children:e.jsxs(xs,{className:"flex items-center gap-2 text-right",children:[e.jsx(fs,{className:"h-5 w-5 text-amber-500","aria-hidden":"true"}),e.jsx("span",{children:"تأكيد قبول طلب الترقية"})]})}),e.jsxs("div",{className:"py-4 text-right",children:[e.jsx("div",{id:"approval-description",className:"mb-4 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsx("p",{className:"text-gray-700 leading-relaxed",children:"هل أنت متأكد من قبول ترقية هذا العميل لحساب الجملة؟"})}),e.jsxs("div",{id:"approval-details",className:"space-y-2 text-sm text-gray-600",role:"region","aria-label":"تفاصيل طلب الترقية",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:o}),e.jsx("span",{children:"اسم العميل:"})]}),g&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:g}),e.jsx("span",{children:"اسم الشركة:"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"ملاحظة:"})," سيتم منح العميل صلاحية الشراء من قسم الجملة مع الاحتفاظ بنوع حسابه الأصلي (تجزئة)."]})})]}),e.jsxs(hs,{className:"flex gap-2 justify-start",children:[e.jsxs(Q,{onClick:a,variant:"outline",disabled:f,className:"flex items-center gap-2","aria-label":"إلغاء العملية",children:[e.jsx(We,{className:"h-4 w-4","aria-hidden":"true"}),"إلغاء"]}),e.jsx(Q,{onClick:u,disabled:f,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700","aria-label":"تأكيد قبول الطلب",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}),"جاري المعالجة..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ps,{className:"h-4 w-4"}),"تأكيد القبول"]})})]})]})}),Qs=()=>{var Ne,ye,we;const t=gs(),[a,u]=r.useState("pending"),[o,g]=r.useState([]),[f,h]=r.useState([]),[T,R]=r.useState(!0),[k,c]=r.useState(null),[b,E]=r.useState(""),[$,V]=r.useState({isVisible:!1,message:"",type:"success"}),[S,d]=r.useState(!1),[m,I]=r.useState({isOpen:!1,selectedApplication:null,isLoading:!1}),[x,w]=r.useState({isOpen:!1,requestId:null,isLoading:!1});r.useRef(null);const B=r.useRef(0),F=r.useRef(!0),p=r.useCallback((s,n="success")=>{V({isVisible:!0,message:s,type:n});const i=setTimeout(()=>{V(v=>({...v,isVisible:!1}))},3e3);return()=>clearTimeout(i)},[]),L=r.useCallback(()=>{V(s=>({...s,isVisible:!1}))},[]),Z=r.useCallback(s=>{console.error("Authentication error:",s),p("انتهت جلسة المسؤول. يرجى تسجيل الدخول مرة أخرى","error"),setTimeout(()=>{t("/admin/login",{replace:!0})},2e3)},[t,p]),N=r.useCallback(async(s=!1)=>{var i,v,C,y,z;const n=Date.now();if(S&&!s&&n-B.current<1e3){console.log("⏭️ Skipping duplicate refresh request");return}B.current=n,c(null),R(!0),d(!0);try{const M={_t:Date.now(),_cache:"no-cache"};if(console.log(`🔄 Fetching ${a} data with params:`,M),a==="pending")try{console.log("📥 Fetching pending wholesale applications...");const _=await J.getWholesaleApplications(M);console.log("✅ Fetched applications:",_);const P=(A=>{if(!Array.isArray(A))return console.warn("⚠️ Expected array of applications but got:",A),[];const q=new Map;A.forEach(l=>{if(l&&l.id){const G={...l,id:l.id.toString(),createdAt:l.createdAt||new Date().toISOString(),status:l.status||"pending"};q.set(l.id,G)}});const O=Array.from(q.values());return console.log(`🔄 Processed ${O.length} applications`),O})(_);g(P)}catch(_){if(console.error("❌ Error fetching applications:",_),((i=_.response)==null?void 0:i.status)===401){Z(_);return}throw _}else if(a==="customers")try{console.log("📥 Fetching wholesale customers...");const _=await J.getWholesaleCustomers(M);console.log("✅ Raw customers data from API:",_);const P=(A=>{if(!Array.isArray(A))return console.warn("⚠️ Expected array of customers but got:",A),[];const q=new Map;A.forEach(l=>{var G,Ce,_e;if(l&&l.id){console.log("📝 Processing customer:",{id:l.id,name:l.full_name||l.userName,email:l.email||l.userEmail,hasDocs:!!((G=l.documents)!=null&&G.id_document_url||l.id_document_url)});const Te={...l,id:l.id.toString(),full_name:l.full_name||l.userName||"غير معروف",userEmail:l.email||l.userEmail||"",phone:l.phone||"",company_name:l.company_name||"غير محدد",createdAt:l.createdAt||l.created_at||new Date().toISOString(),documents:{id_document_url:((Ce=l.documents)==null?void 0:Ce.id_document_url)||l.id_document_url||"",commercial_document_url:((_e=l.documents)==null?void 0:_e.commercial_document_url)||l.commercial_document_url||""}};q.set(Te.id,Te)}});const O=Array.from(q.values());return console.log(`🔄 Processed ${O.length} customers`),O})(_);console.log("✅ Setting customers state with:",P),h(P)}catch(_){if(console.error("❌ Error fetching customers:",{message:_.message,response:(v=_.response)==null?void 0:v.data,status:(C=_.response)==null?void 0:C.status,stack:_.stack}),((y=_.response)==null?void 0:y.status)===401){Z(_);return}throw c("فشل تحميل بيانات العملاء. يرجى المحاولة مرة أخرى."),_}}catch(M){console.error("Error in fetchData:",M),c("حدث خطأ في تحميل البيانات"),((z=M.response)==null?void 0:z.status)===401&&Z(M)}finally{R(!1),d(!1)}},[a,S,Z]),se=r.useCallback(async()=>{var z,M,_;if(!m.selectedApplication){console.error("❌ [WholesaleCustomersPage2] No application selected for approval"),p("لم يتم تحديد طلب للموافقة","error");return}const{id:s,request_id:n,user_id:i,userName:v,companyName:C}=m.selectedApplication,y=n||s;if(!y){console.error("❌ [WholesaleCustomersPage2] Missing request ID in selected application",{selectedApplication:m.selectedApplication,availableKeys:Object.keys(m.selectedApplication)}),p("معرف الطلب غير صالح - يرجى تحديث الصفحة والمحاولة مرة أخرى","error");return}console.log("✅ [WholesaleCustomersPage2] Processing approval confirmation for:",{request_id:y,application_id:s,user_id:i,user_name:v||"غير محدد",company_name:C||"غير محدد",timestamp:new Date().toISOString()}),I(j=>({...j,isLoading:!0}));try{console.log(`🔄 [WholesaleCustomersPage2] Calling approveWholesaleUpgrade with requestId: ${y}`);const j=await J.approveWholesaleUpgrade(y);console.log("✅ [WholesaleCustomersPage2] Approval successful:",{request_id:y,result:j,timestamp:new Date().toISOString()}),p("تمت الموافقة على طلب الترقية بنجاح","success"),I({isOpen:!1,selectedApplication:null,isLoading:!1}),await N(!0);try{console.log("🔄 [WholesaleCustomersPage2] Fetching updated wholesale customers list...");const P=await J.getWholesaleCustomers();console.log(`✅ [WholesaleCustomersPage2] Successfully fetched ${(P==null?void 0:P.length)||0} wholesale customers`),h(P)}catch(P){console.error("❌ [WholesaleCustomersPage2] Failed to fetch wholesale customers after approval:",{error:P.message,requestId:y,timestamp:new Date().toISOString()})}}catch(j){const P={request_id:y,error:j.message,response:(z=j.response)==null?void 0:z.data,status:(M=j.response)==null?void 0:M.status,timestamp:new Date().toISOString()};console.error("❌ [WholesaleCustomersPage2] Failed to approve application:",P);let A="حدث خطأ غير متوقع",q=!1,O=!1;if(j.response?j.response.status===401?(A="انتهت جلستك. يرجى تسجيل الدخول مرة أخرى",q=!0,O=!0):j.response.status===403?A="ليس لديك صلاحيات الموافقة على طلبات الترقية":j.response.status===404?(A="الطلب غير موجود أو تم حذفه",q=!0,O=!0,g(l=>l.filter(G=>(G.request_id||G.id)!==y))):(_=j.response.data)!=null&&_.message&&(A=j.response.data.message):j.request?A="تعذر الاتصال بالخادم. يرجى التحقق من اتصال الإنترنت":j.message?j.message.includes("الطلب غير موجود")||j.message.includes("غير موجود")?(A="الطلب غير موجود أو تم حذفه",q=!0,O=!0,g(l=>l.filter(G=>(G.request_id||G.id)!==y))):j.message.includes("تم معالجة هذا الطلب مسبقاً")||j.message.includes("معالجة")?(A="تم معالجة هذا الطلب مسبقاً",q=!0,O=!0):j.message.includes("بيانات الطلب غير صالحة")&&(A="بيانات الطلب غير صالحة - يرجى تحديث الصفحة والمحاولة مرة أخرى",O=!0):A=j.message||"حدث خطأ غير متوقع",p(`فشل في الموافقة على الطلب: ${A}`,"error"),q&&I({isOpen:!1,selectedApplication:null,isLoading:!1}),O)try{await N(!0);const l=await J.getWholesaleCustomers();h(l)}catch(l){console.error("❌ Failed to refresh data after error:",l)}}},[m,p,N]),oe=r.useCallback(()=>{if(m.isLoading){console.log("⚠️ Cannot close modal while processing");return}console.log("🔄 Closing approval modal"),I({isOpen:!1,selectedApplication:null,isLoading:!1})},[m.isLoading]),le=r.useCallback(s=>{if(!s){console.error("❌ [WholesaleCustomersPage2] No application data provided"),p("بيانات الطلب غير صحيحة","error");return}const{commercial_license:n,tax_certificate:i,...v}=s;console.log("🔍 [WholesaleCustomersPage2] Application data received:",{...v,has_commercial_license:!!n,has_tax_certificate:!!i});const C=s.request_id||s.id,y=s.user_id||s.userId;if(!C){console.error("❌ [WholesaleCustomersPage2] No valid request ID found in application",{applicationId:s.id,userId:y,availableKeys:Object.keys(s)}),p("معرف الطلب غير صالح - يرجى تحديث الصفحة والمحاولة مرة أخرى","error");return}if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(C)){const M=`❌ [WholesaleCustomersPage2] Invalid request ID format: ${C}`;console.error(M,{requestId:C,applicationId:s.id,userId:y}),p("معرف الطلب غير صالح - يرجى تحديث الصفحة","error");return}console.log("🔍 [WholesaleCustomersPage2] Processing approval for:",{request_id:C,application_id:s.id,user_id:y,company_name:s.companyName||"غير محدد",user_name:s.userName||"غير محدد"}),I({isOpen:!0,selectedApplication:{...s,id:C,request_id:C,user_id:y,userId:y},isLoading:!1})},[p]);r.useEffect(()=>{F.current=!0,N(!0);const s=setInterval(()=>{document.visibilityState==="visible"&&N(!0)},3e4);return()=>{F.current=!1,clearInterval(s)}},[a]),r.useEffect(()=>{F.current&&N(!0)},[a]);const ge=r.useCallback(async()=>{try{await N(!0),p("تم تحديث البيانات بنجاح","success")}catch{p("حدث خطأ أثناء تحديث البيانات","error")}},[N,p]),ie=r.useCallback(async s=>{if(!s){p("معرف الطلب غير صالح","error");return}console.log(`🗑️ Deleting request: ${s}`);try{w(i=>({...i,isLoading:!0}));const n=await J.deleteWholesaleRequest(s);console.log("✅ Deletion successful:",n),p("تم حذف الطلب بنجاح","success"),w({isOpen:!1,requestId:null,isLoading:!1}),await N(!0)}catch(n){console.error("❌ Error deleting application:",n);let i="حدث خطأ أثناء حذف الطلب";n.message.includes("الطلب غير موجود")||n.message.includes("غير موجود")?(i="الطلب غير موجود أو تم حذفه مسبقاً",g(v=>v.filter(C=>C.id!==s))):n.message.includes("غير مصرح")?i="غير مصرح لك بحذف هذا الطلب":i=n.message||"حدث خطأ أثناء حذف الطلب",p(i,"error"),w(v=>({...v,isLoading:!1}))}},[N,p]),U=r.useCallback(s=>{w({isOpen:!0,requestId:s,isLoading:!1})},[]),be=r.useCallback(()=>{x.isLoading||w({isOpen:!1,requestId:null,isLoading:!1})},[x.isLoading]),ns=r.useCallback(async(s,n="تم رفض الطلب من قبل المسؤول")=>{if(!s){p("معرف الطلب غير صالح","error");return}console.log(`🔄 Rejecting request: ${s}`);try{const i=await J.updateRequestStatus(s,"rejected",n);console.log("✅ Rejection successful:",i),p("تم رفض الطلب بنجاح","success"),await N(!0)}catch(i){console.error("❌ Error rejecting application:",i);let v="حدث خطأ أثناء معالجة الطلب";i.message.includes("الطلب غير موجود")||i.message.includes("غير موجود")?(v="الطلب غير موجود أو تم حذفه",g(C=>C.filter(y=>y.id!==s)),await N(!0)):i.message.includes("تم معالجة هذا الطلب مسبقاً")||i.message.includes("معالجة")?(v="تم معالجة هذا الطلب مسبقاً",await N(!0)):i.message.includes("بيانات الطلب غير صالحة")?(v="بيانات الطلب غير صالحة - يرجى تحديث الصفحة والمحاولة مرة أخرى",await N(!0)):v=i.message||"حدث خطأ أثناء معالجة الطلب",p(v,"error")}},[N,p]),ve=(o||[]).filter(s=>{if(!s)return!1;const n=b.toLowerCase();return(s.userName||"").toLowerCase().includes(n)||(s.userEmail||"").toLowerCase().includes(n)||(s.companyName||"").toLowerCase().includes(n)||(s.taxNumber||"").toLowerCase().includes(n)||(s.status||"").toLowerCase().includes(n)}),je=f.filter(s=>{var i,v,C,y,z;const n=b.toLowerCase();return((i=s.userName)==null?void 0:i.toLowerCase().includes(n))||((v=s.userEmail)==null?void 0:v.toLowerCase().includes(n))||((C=s.phone)==null?void 0:C.toLowerCase().includes(n))||((y=s.companyName)==null?void 0:y.toLowerCase().includes(n))||((z=s.full_name)==null?void 0:z.toLowerCase().includes(n))}),os=s=>{u(s),R(!0),c(null)};return r.useCallback(()=>{N(!0)},[N]),r.useEffect(()=>{console.log("🔄 Customers state updated:",{count:f.length,customers:f.map(s=>{var n,i;return{id:s.id,name:s.full_name||s.userName,email:s.userEmail,hasDocs:!!((n=s.documents)!=null&&n.id_document_url||(i=s.documents)!=null&&i.commercial_document_url)}})})},[f]),r.useEffect(()=>{console.log("🏁 Component mounted or activeTab changed:",{activeTab:a}),F.current=!0,N(!0);const s=()=>{document.visibilityState==="visible"&&F.current&&(console.log("👀 Page became visible, refreshing data..."),N(!0))};return document.addEventListener("visibilitychange",s),()=>{console.log("🧹 Cleaning up..."),F.current=!1,document.removeEventListener("visibilitychange",s)}},[N,a]),e.jsxs("div",{className:"p-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"إدارة عملاء الجملة"}),e.jsx(Q,{variant:"outline",size:"icon",onClick:async s=>{const n=s.currentTarget;n.classList.add("scale-90");try{await ge()}catch(i){console.error("Error during refresh:",i)}finally{setTimeout(()=>{n.classList.remove("scale-90")},200)}},disabled:S,className:`h-10 w-10 transition-all duration-200 ease-in-out 
                      bg-white hover:bg-green-50 
                      dark:bg-white/90 dark:hover:bg-green-50/80
                      border-gray-200 dark:border-gray-300
                      active:bg-green-100 dark:active:bg-green-100
                      active:scale-95 shadow-sm
                      ${S?"text-green-600":"text-gray-800"}`,title:"تحديث البيانات",children:e.jsx(re,{className:`h-5 w-5 transition-transform ${S?"animate-spin":"group-hover:rotate-180"}`})})]}),e.jsx("div",{className:"w-full md:w-1/3",children:e.jsxs("div",{className:"relative",children:[e.jsx(bs,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(vs,{placeholder:"ابحث عن عميل...",className:"pr-10 text-right w-full",value:b,onChange:s=>E(s.target.value)})]})})]}),e.jsxs(Bs,{defaultValue:"pending",value:a,onValueChange:os,className:"space-y-4",children:[e.jsxs(Us,{className:"grid w-full grid-cols-2 max-w-md mx-auto rtl:mx-0 rtl:mr-auto",children:[e.jsxs(De,{value:"pending",className:"flex items-center justify-center rtl:flex-row-reverse gap-2 relative",children:[e.jsx(js,{className:"h-4 w-4"}),e.jsx("span",{children:"طلبات الانتظار"}),o.length>0&&e.jsx(ce,{variant:"secondary",className:"absolute -top-2 -right-2 h-5 w-5 flex items-center justify-center p-0 rounded-full bg-red-500 text-white",children:o.length})]}),e.jsxs(De,{value:"customers",className:"flex items-center justify-center rtl:flex-row-reverse",children:[e.jsx(de,{className:"ml-2 h-4 w-4"}),"العملاء النشطين",e.jsx(ce,{variant:"secondary",className:"mr-2",children:f.length.toLocaleString("ar-SA")})]})]}),e.jsx(Fe,{value:"pending",children:e.jsxs(Ie,{className:"border rounded-lg overflow-hidden",children:[e.jsx(Ae,{className:"bg-gray-50 flex flex-row justify-end flex flex-row justify-end",children:e.jsx(ke,{className:"text-lg font-semibold text-gray-800",children:"طلبات الانتظار"})}),e.jsx(Re,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Me,{className:"w-full text-right rtl",children:[e.jsx(Pe,{className:"bg-gray-100",children:e.jsxs(Y,{children:[e.jsx(W,{className:"text-right font-bold px-4 py-3",children:"الإجراءات"}),e.jsx(W,{className:"text-right font-bold px-4 py-3",children:"تاريخ الطلب"}),e.jsx(W,{className:"text-right font-bold px-4 py-3",children:"المستندات"}),e.jsx(W,{className:"text-right font-bold px-4 py-3",children:"معلومات الشركة"}),e.jsx(W,{className:"text-right font-bold px-4 py-3",children:"معلومات العميل"})]})}),e.jsx(Oe,{children:T?e.jsx(Y,{children:e.jsx(D,{colSpan:5,className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-500",children:[e.jsx(re,{className:"h-4 w-4 animate-spin"}),"جاري التحميل..."]})})}):ve.length>0?ve.map(s=>e.jsxs(Y,{className:"hover:bg-gray-50",children:[e.jsx(D,{className:"px-4 py-3 align-top border-t",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(Q,{size:"sm",className:"gap-1 bg-green-600 hover:bg-green-700 rtl:flex-row-reverse",onClick:()=>le(s),children:[e.jsx(Ns,{className:"h-4 w-4"}),e.jsx("span",{children:"قبول"})]}),e.jsxs(Q,{variant:"destructive",size:"sm",className:"gap-1 bg-amber-600 hover:bg-amber-700 text-white rtl:flex-row-reverse border-amber-700 hover:border-amber-800 focus:ring-2 focus:ring-amber-500 focus:ring-offset-1",onClick:()=>ns(s.id),children:[e.jsx(We,{className:"h-4 w-4"}),e.jsx("span",{children:"رفض الطلب"})]}),e.jsxs(Q,{variant:"ghost",size:"sm",className:"gap-1 text-red-600 hover:text-white hover:bg-red-600 rtl:flex-row-reverse",onClick:()=>U(s.id),title:"حذف الطلب",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"حذف"})]})]})}),e.jsx(D,{className:"px-4 py-3 align-top border-t",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:new Date(s.createdAt).toLocaleDateString("ar-SA")}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.createdAt).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})})]})}),e.jsx(D,{className:"px-4 py-3 align-top border-t",children:e.jsxs("div",{className:"space-y-2",children:[s.id_document_url&&e.jsxs("a",{href:`${"https://almotamad-pharma-store2-production.up.railway.app/api/v1".replace("/api","")}${s.id_document_url}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-sm text-blue-600 hover:text-blue-700 hover:underline rtl:flex-row-reverse",onClick:n=>{n.preventDefault(),window.open(`${"https://almotamad-pharma-store2-production.up.railway.app/api/v1".replace("/api","")}${s.id_document_url}`,"_blank","noopener,noreferrer")},children:[e.jsx(ae,{className:"ml-2 h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:"الهوية/الإقامة"})]}),s.commercial_document_url&&e.jsxs("a",{href:`${"https://almotamad-pharma-store2-production.up.railway.app/api/v1".replace("/api","")}${s.commercial_document_url}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-sm text-blue-600 hover:text-blue-700 hover:underline rtl:flex-row-reverse",onClick:n=>{n.preventDefault(),window.open(`${"https://almotamad-pharma-store2-production.up.railway.app/api/v1".replace("/api","")}${s.commercial_document_url}`,"_blank","noopener,noreferrer")},children:[e.jsx(ae,{className:"ml-2 h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:"السجل التجاري"})]}),!s.id_document_url&&!s.commercial_document_url&&e.jsx("span",{className:"text-sm text-gray-500",children:"لا توجد مستندات"})]})}),e.jsx(D,{className:"px-4 py-3 align-top border-t",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center rtl:flex-row-reverse",children:[e.jsx(ys,{className:"ml-2 h-4 w-4 text-primary flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:s.companyName||"غير محدد"})]}),e.jsxs("div",{className:"space-y-1 pr-6",children:[s.tax_number&&e.jsxs("div",{className:"text-sm text-gray-600 rtl:text-right",children:[e.jsx("span",{className:"text-gray-500",children:"الرقم الضريبي: "}),e.jsx("span",{className:"font-medium",children:s.tax_number})]}),s.commercial_register&&e.jsxs("div",{className:"text-sm text-gray-600 rtl:text-right",children:[e.jsx("span",{className:"text-gray-500",children:"السجل التجاري: "}),e.jsx("span",{className:"font-medium",children:s.commercial_register})]})]})]})}),e.jsx(D,{className:"px-4 py-3 align-top border-t",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-gray-900 rtl:flex-row-reverse",children:[e.jsx(de,{className:"ml-2 h-4 w-4 text-primary flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:s.userName||"غير معروف"})]}),e.jsxs("div",{className:"space-y-1 pr-6",children:[s.userEmail&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600 rtl:flex-row-reverse",children:[e.jsx(Ee,{className:"ml-2 h-3.5 w-3.5 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",title:s.userEmail,children:s.userEmail})]}),s.phone&&s.phone!==s.userEmail&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600 rtl:flex-row-reverse",children:[e.jsx(Le,{className:"ml-2 h-3.5 w-3.5 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"ltr",children:s.phone})]})]})]})})]},s.id)):e.jsx(Y,{children:e.jsx(D,{colSpan:5,className:"text-center py-8 text-gray-500",children:"لا توجد طلبات في الوقت الحالي"})})})]})})})]})}),e.jsx(Fe,{value:"customers",children:e.jsxs(Ie,{className:"border rounded-lg overflow-hidden",children:[e.jsx(Ae,{className:"bg-gray-50",children:e.jsx(ke,{className:"text-lg font-semibold text-gray-800",children:"العملاء النشطين"})}),e.jsx(Re,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",dir:"rtl",children:e.jsxs(Me,{className:"w-full",children:[e.jsx(Pe,{className:"bg-gray-100",children:e.jsxs(Y,{children:[e.jsx(W,{className:"font-bold px-4 py-3 text-right",children:"العميل"}),e.jsx(W,{className:"font-bold px-4 py-3 text-right",children:"البريد الإلكتروني"}),e.jsx(W,{className:"font-bold px-4 py-3 text-right",children:"رقم الجوال"}),e.jsx(W,{className:"font-bold px-4 py-3 text-right",children:"الملفات"}),e.jsx(W,{className:"font-bold px-4 py-3 text-right",children:"تاريخ التسجيل"}),e.jsx(W,{className:"font-bold px-4 py-3 text-right",children:"الحالة"})]})}),e.jsx(Oe,{children:T?e.jsx(Y,{children:e.jsx(D,{colSpan:6,className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-500",children:[e.jsx(re,{className:"h-4 w-4 animate-spin"}),"جاري التحميل..."]})})}):je.length>0?je.map(s=>{var n,i,v,C;return e.jsxs(Y,{className:"hover:bg-gray-50",children:[e.jsx(D,{className:"px-4 py-3 border-t",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(de,{className:"ml-2 h-4 w-4 text-primary flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:s.full_name||s.userName||"غير معروف"})]})}),e.jsx(D,{className:"px-4 py-3 border-t",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{className:"ml-2 h-4 w-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",dir:"ltr",children:s.userEmail||"غير متوفر"})]})}),e.jsx(D,{className:"px-4 py-3 border-t",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Le,{className:"ml-2 h-4 w-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"whitespace-nowrap",children:s.phone||"غير متوفر"})]})}),e.jsx(D,{className:"px-4 py-3 border-t",children:e.jsxs("div",{className:"space-y-1",children:[((n=s.documents)==null?void 0:n.id_document_url)&&e.jsxs("a",{href:`${"https://almotamad-pharma-store2-production.up.railway.app/api/v1".replace("/api","")}${s.documents.id_document_url}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-sm text-blue-600 hover:text-blue-700 hover:underline",children:[e.jsx(ae,{className:"ml-2 h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:"الهوية/الإقامة"})]}),((i=s.documents)==null?void 0:i.commercial_document_url)&&e.jsxs("a",{href:`${"https://almotamad-pharma-store2-production.up.railway.app/api/v1".replace("/api","")}${s.documents.commercial_document_url}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-sm text-blue-600 hover:text-blue-700 hover:underline",children:[e.jsx(ae,{className:"ml-2 h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:"السجل التجاري"})]}),!((v=s.documents)!=null&&v.id_document_url)&&!((C=s.documents)!=null&&C.commercial_document_url)&&e.jsx("span",{className:"text-sm text-gray-500",children:"لا توجد مستندات"})]})}),e.jsx(D,{className:"px-4 py-3 border-t",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:new Date(s.createdAt).toLocaleDateString("ar-SA")}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.createdAt).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})})]})}),e.jsx(D,{className:"px-4 py-3 border-t",children:e.jsx(ce,{className:`${s.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"} w-fit`,children:s.is_active?"نشط":"غير نشط"})})]},s.id)}):e.jsx(Y,{children:e.jsx(D,{colSpan:6,className:"text-center py-8 text-gray-500",children:"لا يوجد عملاء مسجلين"})})})]})})})]})})]}),e.jsx(ws,{isVisible:$.isVisible,message:$.message,type:$.type,onClose:L}),e.jsx(zs,{isOpen:m.isOpen,onClose:oe,onConfirm:se,customerName:((Ne=m.selectedApplication)==null?void 0:Ne.full_name)||((ye=m.selectedApplication)==null?void 0:ye.userName)||"غير معروف",companyName:(we=m.selectedApplication)==null?void 0:we.company_name,isLoading:m.isLoading}),e.jsxs("div",{className:`fixed inset-0 z-50 flex items-center justify-center transition-opacity ${x.isOpen?"opacity-100":"opacity-0 pointer-events-none"}`,children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:be}),e.jsx("div",{className:"relative bg-white rounded-lg p-6 w-full max-w-md mx-4 shadow-xl transition-all transform ${deleteModal.isOpen ? 'scale-100' : 'scale-95'}",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:e.jsx(ue,{className:"h-6 w-6 text-red-600"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"تأكيد حذف الطلب"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-6",children:[e.jsx("span",{className:"block mb-2 font-medium",children:"هل أنت متأكد من رغبتك في حذف هذا الطلب؟"}),e.jsx("span",{className:"text-red-600",children:"هذا الإجراء لا يمكن التراجع عنه."})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx(Q,{variant:"outline",onClick:be,disabled:x.isLoading,className:"px-4",children:"إلغاء"}),e.jsx(Q,{variant:"destructive",onClick:()=>ie(x.requestId),disabled:x.isLoading,className:"px-6 gap-2 bg-red-600 hover:bg-red-700 focus:ring-2 focus:ring-red-500 focus:ring-offset-2",children:x.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"جاري الحذف..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{children:"نعم، احذف الطلب"})]})})]})]})})]})]})};export{Qs as default};
