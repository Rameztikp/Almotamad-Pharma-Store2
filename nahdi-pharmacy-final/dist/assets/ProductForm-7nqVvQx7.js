import{r as l,f as S,S as fe,j as r,M as Oe,U as Re}from"./index-BUkTSXir.js";import{p as pe,o as Te,i as Ie,j as _e,l as Ae,n as Le}from"./adminRoutes-CxNN_s_q.js";import{y as K}from"./index-Csc-4bEh.js";var Me=Object.defineProperty,Ue=(e,t,s)=>t in e?Me(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,le=(e,t,s)=>(Ue(e,typeof t!="symbol"?t+"":t,s),s);let qe=class{constructor(){le(this,"current",this.detect()),le(this,"handoffState","pending"),le(this,"currentId",0)}set(t){this.current!==t&&(this.handoffState="pending",this.currentId=0,this.current=t)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return this.current==="server"}get isClient(){return this.current==="client"}detect(){return typeof window>"u"||typeof document>"u"?"server":"client"}handoff(){this.handoffState==="pending"&&(this.handoffState="complete")}get isHandoffComplete(){return this.handoffState==="complete"}},X=new qe;function De(e){typeof queueMicrotask=="function"?queueMicrotask(e):Promise.resolve().then(e).catch(t=>setTimeout(()=>{throw t}))}function ee(){let e=[],t={addEventListener(s,n,i,c){return s.addEventListener(n,i,c),t.add(()=>s.removeEventListener(n,i,c))},requestAnimationFrame(...s){let n=requestAnimationFrame(...s);return t.add(()=>cancelAnimationFrame(n))},nextFrame(...s){return t.requestAnimationFrame(()=>t.requestAnimationFrame(...s))},setTimeout(...s){let n=setTimeout(...s);return t.add(()=>clearTimeout(n))},microTask(...s){let n={current:!0};return De(()=>{n.current&&s[0]()}),t.add(()=>{n.current=!1})},style(s,n,i){let c=s.style.getPropertyValue(n);return Object.assign(s.style,{[n]:i}),this.add(()=>{Object.assign(s.style,{[n]:c})})},group(s){let n=ee();return s(n),this.add(()=>n.dispose())},add(s){return e.includes(s)||e.push(s),()=>{let n=e.indexOf(s);if(n>=0)for(let i of e.splice(n,1))i()}},dispose(){for(let s of e.splice(0))s()}};return t}function be(){let[e]=l.useState(ee);return l.useEffect(()=>()=>e.dispose(),[e]),e}let L=(e,t)=>{X.isServer?l.useEffect(e,t):l.useLayoutEffect(e,t)};function he(e){let t=l.useRef(e);return L(()=>{t.current=e},[e]),t}let I=function(e){let t=he(e);return S.useCallback((...s)=>t.current(...s),[t])};function oe(...e){return Array.from(new Set(e.flatMap(t=>typeof t=="string"?t.split(" "):[]))).filter(Boolean).join(" ")}function te(e,t,...s){if(e in t){let i=t[e];return typeof i=="function"?i(...s):i}let n=new Error(`Tried to handle "${e}" but there is no handler defined. Only defined handlers are: ${Object.keys(t).map(i=>`"${i}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,te),n}var xe=(e=>(e[e.None=0]="None",e[e.RenderStrategy=1]="RenderStrategy",e[e.Static=2]="Static",e))(xe||{}),A=(e=>(e[e.Unmount=0]="Unmount",e[e.Hidden=1]="Hidden",e))(A||{});function ve(){let e=ze();return l.useCallback(t=>He({mergeRefs:e,...t}),[e])}function He({ourProps:e,theirProps:t,slot:s,defaultTag:n,features:i,visible:c=!0,name:g,mergeRefs:f}){f=f??Ve;let o=ye(t,e);if(c)return Q(o,s,n,g,f);let a=i??0;if(a&2){let{static:u=!1,...y}=o;if(u)return Q(y,s,n,g,f)}if(a&1){let{unmount:u=!0,...y}=o;return te(u?0:1,{0(){return null},1(){return Q({...y,hidden:!0,style:{display:"none"}},s,n,g,f)}})}return Q(o,s,n,g,f)}function Q(e,t={},s,n,i){let{as:c=s,children:g,refName:f="ref",...o}=ie(e,["unmount","static"]),a=e.ref!==void 0?{[f]:e.ref}:{},u=typeof g=="function"?g(t):g;"className"in o&&o.className&&typeof o.className=="function"&&(o.className=o.className(t)),o["aria-labelledby"]&&o["aria-labelledby"]===o.id&&(o["aria-labelledby"]=void 0);let y={};if(t){let w=!1,p=[];for(let[b,j]of Object.entries(t))typeof j=="boolean"&&(w=!0),j===!0&&p.push(b.replace(/([A-Z])/g,v=>`-${v.toLowerCase()}`));if(w){y["data-headlessui-state"]=p.join(" ");for(let b of p)y[`data-${b}`]=""}}if(c===l.Fragment&&(Object.keys(H(o)).length>0||Object.keys(H(y)).length>0))if(!l.isValidElement(u)||Array.isArray(u)&&u.length>1){if(Object.keys(H(o)).length>0)throw new Error(['Passing props on "Fragment"!',"",`The current component <${n} /> is rendering a "Fragment".`,"However we need to passthrough the following props:",Object.keys(H(o)).concat(Object.keys(H(y))).map(w=>`  - ${w}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map(w=>`  - ${w}`).join(`
`)].join(`
`))}else{let w=u.props,p=w==null?void 0:w.className,b=typeof p=="function"?(...m)=>oe(p(...m),o.className):oe(p,o.className),j=b?{className:b}:{},v=ye(u.props,H(ie(o,["ref"])));for(let m in y)m in v&&delete y[m];return l.cloneElement(u,Object.assign({},v,y,a,{ref:i(Be(u),a.ref)},j))}return l.createElement(c,Object.assign({},ie(o,["ref"]),c!==l.Fragment&&a,c!==l.Fragment&&y),u)}function ze(){let e=l.useRef([]),t=l.useCallback(s=>{for(let n of e.current)n!=null&&(typeof n=="function"?n(s):n.current=s)},[]);return(...s)=>{if(!s.every(n=>n==null))return e.current=s,t}}function Ve(...e){return e.every(t=>t==null)?void 0:t=>{for(let s of e)s!=null&&(typeof s=="function"?s(t):s.current=t)}}function ye(...e){if(e.length===0)return{};if(e.length===1)return e[0];let t={},s={};for(let n of e)for(let i in n)i.startsWith("on")&&typeof n[i]=="function"?(s[i]!=null||(s[i]=[]),s[i].push(n[i])):t[i]=n[i];if(t.disabled||t["aria-disabled"])for(let n in s)/^(on(?:Click|Pointer|Mouse|Key)(?:Down|Up|Press)?)$/.test(n)&&(s[n]=[i=>{var c;return(c=i==null?void 0:i.preventDefault)==null?void 0:c.call(i)}]);for(let n in s)Object.assign(t,{[n](i,...c){let g=s[n];for(let f of g){if((i instanceof Event||(i==null?void 0:i.nativeEvent)instanceof Event)&&i.defaultPrevented)return;f(i,...c)}}});return t}function ue(e){var t;return Object.assign(l.forwardRef(e),{displayName:(t=e.displayName)!=null?t:e.name})}function H(e){let t=Object.assign({},e);for(let s in t)t[s]===void 0&&delete t[s];return t}function ie(e,t=[]){let s=Object.assign({},e);for(let n of t)n in s&&delete s[n];return s}function Be(e){return S.version.split(".")[0]>="19"?e.props.ref:e.ref}let We=Symbol();function je(...e){let t=l.useRef(e);l.useEffect(()=>{t.current=e},[e]);let s=I(n=>{for(let i of t.current)i!=null&&(typeof i=="function"?i(n):i.current=n)});return e.every(n=>n==null||(n==null?void 0:n[We]))?void 0:s}function Ge(e=0){let[t,s]=l.useState(e),n=l.useCallback(o=>s(o),[t]),i=l.useCallback(o=>s(a=>a|o),[t]),c=l.useCallback(o=>(t&o)===o,[t]),g=l.useCallback(o=>s(a=>a&~o),[s]),f=l.useCallback(o=>s(a=>a^o),[s]);return{flags:t,setFlag:n,addFlag:i,hasFlag:c,removeFlag:g,toggleFlag:f}}var Ke={},me,ge;typeof process<"u"&&typeof globalThis<"u"&&typeof Element<"u"&&((me=process==null?void 0:Ke)==null?void 0:me.NODE_ENV)==="test"&&typeof((ge=Element==null?void 0:Element.prototype)==null?void 0:ge.getAnimations)>"u"&&(Element.prototype.getAnimations=function(){return console.warn(["Headless UI has polyfilled `Element.prototype.getAnimations` for your tests.","Please install a proper polyfill e.g. `jsdom-testing-mocks`, to silence these warnings.","","Example usage:","```js","import { mockAnimationsApi } from 'jsdom-testing-mocks'","mockAnimationsApi()","```"].join(`
`)),[]});var Ye=(e=>(e[e.None=0]="None",e[e.Closed=1]="Closed",e[e.Enter=2]="Enter",e[e.Leave=4]="Leave",e))(Ye||{});function Ze(e){let t={};for(let s in e)e[s]===!0&&(t[`data-${s}`]="");return t}function Je(e,t,s,n){let[i,c]=l.useState(s),{hasFlag:g,addFlag:f,removeFlag:o}=Ge(e&&i?3:0),a=l.useRef(!1),u=l.useRef(!1),y=be();return L(()=>{var w;if(e){if(s&&c(!0),!t){s&&f(3);return}return(w=n==null?void 0:n.start)==null||w.call(n,s),Qe(t,{inFlight:a,prepare(){u.current?u.current=!1:u.current=a.current,a.current=!0,!u.current&&(s?(f(3),o(4)):(f(4),o(2)))},run(){u.current?s?(o(3),f(4)):(o(4),f(3)):s?o(1):f(1)},done(){var p;u.current&&typeof t.getAnimations=="function"&&t.getAnimations().length>0||(a.current=!1,o(7),s||c(!1),(p=n==null?void 0:n.end)==null||p.call(n,s))}})}},[e,s,t,y]),e?[i,{closed:g(1),enter:g(2),leave:g(4),transition:g(2)||g(4)}]:[s,{closed:void 0,enter:void 0,leave:void 0,transition:void 0}]}function Qe(e,{prepare:t,run:s,done:n,inFlight:i}){let c=ee();return et(e,{prepare:t,inFlight:i}),c.nextFrame(()=>{s(),c.requestAnimationFrame(()=>{c.add(Xe(e,n))})}),c.dispose}function Xe(e,t){var s,n;let i=ee();if(!e)return i.dispose;let c=!1;i.add(()=>{c=!0});let g=(n=(s=e.getAnimations)==null?void 0:s.call(e).filter(f=>f instanceof CSSTransition))!=null?n:[];return g.length===0?(t(),i.dispose):(Promise.allSettled(g.map(f=>f.finished)).then(()=>{c||t()}),i.dispose)}function et(e,{inFlight:t,prepare:s}){if(t!=null&&t.current){s();return}let n=e.style.transition;e.style.transition="none",s(),e.offsetHeight,e.style.transition=n}let de=l.createContext(null);de.displayName="OpenClosedContext";var z=(e=>(e[e.Open=1]="Open",e[e.Closed=2]="Closed",e[e.Closing=4]="Closing",e[e.Opening=8]="Opening",e))(z||{});function Ne(){return l.useContext(de)}function tt({value:e,children:t}){return S.createElement(de.Provider,{value:e},t)}function rt(){let e=typeof document>"u";return"useSyncExternalStore"in fe?(t=>t.useSyncExternalStore)(fe)(()=>()=>{},()=>!1,()=>!e):!1}function we(){let e=rt(),[t,s]=l.useState(X.isHandoffComplete);return t&&X.isHandoffComplete===!1&&s(!1),l.useEffect(()=>{t!==!0&&s(!0)},[t]),l.useEffect(()=>X.handoff(),[]),e?!1:t}function st(){let e=l.useRef(!1);return L(()=>(e.current=!0,()=>{e.current=!1}),[]),e}function Ce(e){var t;return!!(e.enter||e.enterFrom||e.enterTo||e.leave||e.leaveFrom||e.leaveTo)||((t=e.as)!=null?t:Ee)!==l.Fragment||S.Children.count(e.children)===1}let re=l.createContext(null);re.displayName="TransitionContext";var nt=(e=>(e.Visible="visible",e.Hidden="hidden",e))(nt||{});function at(){let e=l.useContext(re);if(e===null)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}function lt(){let e=l.useContext(se);if(e===null)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}let se=l.createContext(null);se.displayName="NestingContext";function ne(e){return"children"in e?ne(e.children):e.current.filter(({el:t})=>t.current!==null).filter(({state:t})=>t==="visible").length>0}function ke(e,t){let s=he(e),n=l.useRef([]),i=st(),c=be(),g=I((p,b=A.Hidden)=>{let j=n.current.findIndex(({el:v})=>v===p);j!==-1&&(te(b,{[A.Unmount](){n.current.splice(j,1)},[A.Hidden](){n.current[j].state="hidden"}}),c.microTask(()=>{var v;!ne(n)&&i.current&&((v=s.current)==null||v.call(s))}))}),f=I(p=>{let b=n.current.find(({el:j})=>j===p);return b?b.state!=="visible"&&(b.state="visible"):n.current.push({el:p,state:"visible"}),()=>g(p,A.Unmount)}),o=l.useRef([]),a=l.useRef(Promise.resolve()),u=l.useRef({enter:[],leave:[]}),y=I((p,b,j)=>{o.current.splice(0),t&&(t.chains.current[b]=t.chains.current[b].filter(([v])=>v!==p)),t==null||t.chains.current[b].push([p,new Promise(v=>{o.current.push(v)})]),t==null||t.chains.current[b].push([p,new Promise(v=>{Promise.all(u.current[b].map(([m,E])=>E)).then(()=>v())})]),b==="enter"?a.current=a.current.then(()=>t==null?void 0:t.wait.current).then(()=>j(b)):j(b)}),w=I((p,b,j)=>{Promise.all(u.current[b].splice(0).map(([v,m])=>m)).then(()=>{var v;(v=o.current.shift())==null||v()}).then(()=>j(b))});return l.useMemo(()=>({children:n,register:f,unregister:g,onStart:y,onStop:w,wait:a,chains:u}),[f,g,n,y,w,u,a])}let Ee=l.Fragment,Se=xe.RenderStrategy;function it(e,t){var s,n;let{transition:i=!0,beforeEnter:c,afterEnter:g,beforeLeave:f,afterLeave:o,enter:a,enterFrom:u,enterTo:y,entered:w,leave:p,leaveFrom:b,leaveTo:j,...v}=e,[m,E]=l.useState(null),d=l.useRef(null),P=Ce(e),O=je(...P?[d,t,E]:t===null?[]:[t]),M=(s=v.unmount)==null||s?A.Unmount:A.Hidden,{show:N,appear:Y,initial:Z}=at(),[F,V]=l.useState(N?"visible":"hidden"),x=lt(),{register:h,unregister:C}=x;L(()=>h(d),[h,d]),L(()=>{if(M===A.Hidden&&d.current){if(N&&F!=="visible"){V("visible");return}return te(F,{hidden:()=>C(d),visible:()=>h(d)})}},[F,d,h,C,N,M]);let k=we();L(()=>{if(P&&k&&F==="visible"&&d.current===null)throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")},[d,F,k,P]);let R=Z&&!Y,U=Y&&N&&Z,_=l.useRef(!1),q=ke(()=>{_.current||(V("hidden"),C(d))},x),T=I(ae=>{_.current=!0;let J=ae?"enter":"leave";q.onStart(d,J,G=>{G==="enter"?c==null||c():G==="leave"&&(f==null||f())})}),D=I(ae=>{let J=ae?"enter":"leave";_.current=!1,q.onStop(d,J,G=>{G==="enter"?g==null||g():G==="leave"&&(o==null||o())}),J==="leave"&&!ne(q)&&(V("hidden"),C(d))});l.useEffect(()=>{P&&i||(T(N),D(N))},[N,P,i]);let B=!(!i||!P||!k||R),[,$]=Je(B,m,N,{start:T,end:D}),$e=H({ref:O,className:((n=oe(v.className,U&&a,U&&u,$.enter&&a,$.enter&&$.closed&&u,$.enter&&!$.closed&&y,$.leave&&p,$.leave&&!$.closed&&b,$.leave&&$.closed&&j,!$.transition&&N&&w))==null?void 0:n.trim())||void 0,...Ze($)}),W=0;F==="visible"&&(W|=z.Open),F==="hidden"&&(W|=z.Closed),N&&F==="hidden"&&(W|=z.Opening),!N&&F==="visible"&&(W|=z.Closing);let Pe=ve();return S.createElement(se.Provider,{value:q},S.createElement(tt,{value:W},Pe({ourProps:$e,theirProps:v,defaultTag:Ee,features:Se,visible:F==="visible",name:"Transition.Child"})))}function ot(e,t){let{show:s,appear:n=!1,unmount:i=!0,...c}=e,g=l.useRef(null),f=Ce(e),o=je(...f?[g,t]:t===null?[]:[t]);we();let a=Ne();if(s===void 0&&a!==null&&(s=(a&z.Open)===z.Open),s===void 0)throw new Error("A <Transition /> is used but it is missing a `show={true | false}` prop.");let[u,y]=l.useState(s?"visible":"hidden"),w=ke(()=>{s||y("hidden")}),[p,b]=l.useState(!0),j=l.useRef([s]);L(()=>{p!==!1&&j.current[j.current.length-1]!==s&&(j.current.push(s),b(!1))},[j,s]);let v=l.useMemo(()=>({show:s,appear:n,initial:p}),[s,n,p]);L(()=>{s?y("visible"):!ne(w)&&g.current!==null&&y("hidden")},[s,w]);let m={unmount:i},E=I(()=>{var O;p&&b(!1),(O=e.beforeEnter)==null||O.call(e)}),d=I(()=>{var O;p&&b(!1),(O=e.beforeLeave)==null||O.call(e)}),P=ve();return S.createElement(se.Provider,{value:w},S.createElement(re.Provider,{value:v},P({ourProps:{...m,as:l.Fragment,children:S.createElement(Fe,{ref:o,...m,...c,beforeEnter:E,beforeLeave:d})},theirProps:{},defaultTag:l.Fragment,features:Se,visible:u==="visible",name:"Transition"})))}function ct(e,t){let s=l.useContext(re)!==null,n=Ne()!==null;return S.createElement(S.Fragment,null,!s&&n?S.createElement(ce,{ref:t,...e}):S.createElement(Fe,{ref:t,...e}))}let ce=ue(ot),Fe=ue(it),ut=ue(ct),bt=Object.assign(ce,{Child:ut,Root:ce});const dt=({options:e=[],value:t,onChange:s,placeholder:n="اختر...",loading:i=!1,disabled:c=!1,noOptionsMessage:g="لا توجد خيارات متاحة"})=>{const[f,o]=l.useState(!1),[a,u]=l.useState(""),[y,w]=l.useState(null),p=l.useRef(null);l.useEffect(()=>{if(t){const m=e.find(E=>E.value===t);w(m||null)}else w(null)},[t,e]),l.useEffect(()=>{const m=E=>{p.current&&!p.current.contains(E.target)&&o(!1)};return document.addEventListener("mousedown",m),()=>{document.removeEventListener("mousedown",m)}},[]);const b=e.filter(m=>m.label.toLowerCase().includes(a.toLowerCase())),j=m=>{w(m),s(m.value),u(""),o(!1)},v=m=>{m.stopPropagation(),w(null),s("")};return r.jsxs("div",{className:"relative w-full",ref:p,children:[r.jsxs("div",{className:`flex items-center justify-between w-full p-2 border rounded-lg cursor-pointer ${c?"bg-gray-100":"bg-white"} ${f?"ring-2 ring-blue-500 border-blue-500":"border-gray-300"}`,onClick:()=>!c&&o(!f),children:[y?r.jsx("div",{className:"flex-1 flex items-center",children:r.jsx("span",{className:"text-gray-900",children:y.label})}):r.jsx("span",{className:"text-gray-500",children:n}),r.jsxs("div",{className:"flex items-center space-x-2",children:[y&&r.jsx("button",{type:"button",onClick:v,className:"text-gray-400 hover:text-gray-600",disabled:c,children:r.jsx(pe,{size:14})}),r.jsx(Te,{className:`text-gray-400 transition-transform ${f?"transform rotate-180":""}`,size:14})]})]}),f&&r.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg",children:[r.jsx("div",{className:"p-2 border-b",children:r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:r.jsx(Ie,{className:"text-gray-400"})}),r.jsx("input",{type:"text",className:"w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"ابحث عن فئة...",value:a,onChange:m=>u(m.target.value),autoFocus:!0})]})}),r.jsx("div",{className:"max-h-60 overflow-y-auto",children:i?r.jsx("div",{className:"p-4 text-center text-gray-500",children:"جاري التحميل..."}):b.length>0?r.jsx("ul",{children:b.map(m=>r.jsx("li",{className:`px-4 py-2 cursor-pointer hover:bg-blue-50 ${t===m.value?"bg-blue-50 text-blue-700 font-medium":"text-gray-700"}`,onClick:()=>j(m),children:m.label},m.value))}):r.jsx("div",{className:"p-4 text-center text-gray-500",children:a?"لا توجد نتائج":g})})]})]})},ht=({isOpen:e,onClose:t,onSubmit:s,product:n,type:i})=>{const[c,g]=l.useState([]),[f,o]=l.useState(!0),[a,u]=l.useState({name:"",description:"",price:"",category_id:"",stock:"",images:[],brand:"",sku:"",barcode:"",isActive:!0,isMedicine:!1,expiryDate:"",batchNumber:"",manufacturer:"",requiresPrescription:!1,activeIngredient:"",dosageForm:"",strength:"",storageConditions:"",sideEffects:"",contraindications:""}),[y,w]=l.useState({}),[p,b]=l.useState(!1),[j,v]=l.useState(!1),[m,E]=l.useState([]),[d,P]=l.useState(!1),[O,M]=l.useState(0);l.useEffect(()=>{(async()=>{try{const h=await Oe.getCategories(),C=h.data||h;Array.isArray(C)?(g(C),!n&&C.length>0&&u(k=>({...k,category_id:C[0].id}))):(console.error("تنسيق بيانات الفئات غير متوقع:",C),K.error("حدث خطأ في تحميل الفئات"),g([]))}catch(h){console.error("خطأ في جلب الفئات:",h),K.error("فشل تحميل الفئات. يرجى المحاولة مرة أخرى"),g([])}finally{o(!1)}})()},[]),l.useEffect(()=>{n?(u({name:n.name||"",description:n.description||"",price:n.price||"",category_id:n.category_id||"",stock:n.stock||"",images:n.images||[],brand:n.brand||"",sku:n.sku||"",barcode:n.barcode||"",isMedicine:n.isMedicine||!1,expiryDate:n.expiryDate||"",batchNumber:n.batchNumber||"",manufacturer:n.manufacturer||"",requiresPrescription:n.requiresPrescription||!1,activeIngredient:n.activeIngredient||"",dosageForm:n.dosageForm||"",strength:n.strength||"",storageConditions:n.storageConditions||"",sideEffects:n.sideEffects||"",contraindications:n.contraindications||""}),E(n.images||[]),v(!!n.isMedicine)):(u({name:"",description:"",price:"",category_id:c[0]||"",stock:"",images:[],brand:"",sku:"",barcode:"",isMedicine:!1,expiryDate:"",batchNumber:"",manufacturer:"",requiresPrescription:!1,activeIngredient:"",dosageForm:"",strength:"",storageConditions:"",sideEffects:"",contraindications:""}),E([]),v(!1))},[n,c]);const N=x=>{const{name:h,value:C,type:k,checked:R}=x.target;u(U=>({...U,[h]:k==="checkbox"?R:C}))},Y=()=>{v(!j),u(j?x=>{const{isMedicine:h,...C}=x;return{...C,isMedicine:!1,expiryDate:"",batchNumber:"",manufacturer:"",requiresPrescription:!1,activeIngredient:"",dosageForm:"",strength:"",storageConditions:"",sideEffects:"",contraindications:""}}:x=>({...x,isMedicine:!0}))},Z=x=>{const h=Array.from(x.target.files),C=h.map(k=>({file:k,preview:URL.createObjectURL(k)}));E(k=>[...k,...C]),u(k=>({...k,images:[...k.images,...h]}))},F=x=>{const h=[...m],C=[...a.images];typeof h[x]!="string"&&URL.revokeObjectURL(h[x].preview),h.splice(x,1),C.splice(x,1),E(h),u(k=>({...k,images:C}))},V=async x=>{var C,k;x.preventDefault();const h={};if(a.name||(h.name="اسم المنتج مطلوب"),a.price||(h.price="السعر مطلوب"),a.category_id||(h.category="الفئة مطلوبة"),a.stock||(h.stock="الكمية المتوفرة مطلوبة"),Object.keys(h).length>0){w(h),K.error("الرجاء ملء جميع الحقول المطلوبة");return}if(m.length===0){K.error("الرجاء إضافة صورة واحدة على الأقل للمنتج");return}P(!0);try{let R=[...m];const U=m.filter(T=>typeof T!="string").map(T=>T.file||T);if(U.length>0){b(!0),M(0);const T=setInterval(()=>{M(D=>Math.min(D+10,90))},200);try{const D=await Re.uploadImages(U);R=[...m.filter(B=>typeof B=="string").map(B=>B),...D],clearInterval(T),M(100)}catch{throw clearInterval(T),new Error("فشل رفع الصور. الرجاء المحاولة مرة أخرى")}finally{b(!1)}}const _=i||"retail",q={...a,name:a.name,description:a.description||"",price:parseFloat(a.price),category_id:a.category_id,stock_quantity:parseInt(a.stock_quantity||a.stock||0,10),min_stock_level:parseInt(a.min_stock_level||5,10),sku:a.sku||`${_.toUpperCase()}-${Date.now()}`,barcode:a.barcode||`BC-${Date.now()}`,brand:a.brand||"",images:R,is_medicine:a.isMedicine||!1,is_active:!1,is_featured:!1,type:_,is_wholesale:_==="wholesale",is_retail:_==="retail"};a.isMedicine&&(q.medicine_fields={active_ingredient:a.activeIngredient||"",dosage:a.dosageForm||"",expiration_date:a.expiryDate,batch_number:a.batchNumber||"",manufacturer:a.manufacturer||"",requires_prescription:a.requiresPrescription||!1,strength:a.strength||"",storage_conditions:a.storageConditions||"",side_effects:a.sideEffects||"",contraindications:a.contraindications||""}),await s(q),t()}catch(R){console.error("Error submitting product:",R),K.error(R.message||((k=(C=R.response)==null?void 0:C.data)==null?void 0:k.message)||"حدث خطأ أثناء حفظ المنتج")}finally{P(!1),M(0)}};return e?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"flex justify-between items-center mb-6",children:[r.jsx("h3",{className:"text-xl font-bold text-gray-800",children:n?"تعديل المنتج":"إضافة منتج جديد"}),r.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700",disabled:d,children:r.jsx(pe,{size:24})})]}),r.jsxs("form",{onSubmit:V,className:"space-y-6",children:[r.jsxs("div",{className:"mb-6",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"المعلومات الأساسية"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{className:"col-span-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["اسم المنتج ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",name:"name",value:a.name,onChange:N,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:d})]}),r.jsxs("div",{className:"mb-4",children:[r.jsxs("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"category_id",children:["الفئة ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx(dt,{options:c.map(x=>({value:x.id,label:x.name_ar||x.name})),value:a.category_id,onChange:x=>u(h=>({...h,category_id:x})),placeholder:"اختر فئة المنتج",loading:f,noOptionsMessage:"لا توجد فئات متاحة"}),y.category_id&&r.jsx("p",{className:"text-red-500 text-xs italic mt-1",children:y.category_id})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["السعر (ر.س) ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"number",name:"price",value:a.price,onChange:N,min:"0",step:"0.01",className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,disabled:d})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["الكمية المتوفرة ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"number",name:"stock",value:a.stock,onChange:N,min:"0",className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,disabled:d})]})]}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوصف"}),r.jsx("textarea",{name:"description",value:a.description,onChange:N,rows:"3",className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:d})]}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["صور المنتج ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex flex-wrap gap-4",children:[r.jsxs("label",{className:"flex flex-col items-center justify-center w-32 h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50",children:[p?r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx(_e,{className:"animate-spin text-blue-500 text-2xl mb-2"}),r.jsx("span",{className:"text-xs text-gray-500",children:"جاري الرفع..."})]}):r.jsxs(r.Fragment,{children:[r.jsx(Ae,{className:"text-gray-400 text-2xl mb-2"}),r.jsx("span",{className:"text-sm text-gray-500",children:"رفع صورة"})]}),r.jsx("input",{type:"file",className:"hidden",accept:"image/*",multiple:!0,onChange:Z,disabled:d||p})]}),m.map((x,h)=>r.jsxs("div",{className:"relative group",children:[r.jsx("img",{src:typeof x=="string"?x:x.preview||URL.createObjectURL(x),alt:`Preview ${h+1}`,className:"w-32 h-32 object-cover rounded-lg",onLoad:()=>{typeof x!="string"&&x.preview&&URL.revokeObjectURL(x.preview)}}),r.jsx("button",{type:"button",onClick:()=>F(h),className:"absolute top-1 left-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",disabled:d||p,children:r.jsx(Le,{size:12})})]},h))]}),O>0&&O<100&&r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:r.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${O}%`}})}),r.jsx("p",{className:"text-xs text-gray-500",children:"يمكنك رفع حتى 5 صور كحد أقصى. الصيغ المدعومة: JPG, PNG, WebP"})]})]})]}),r.jsxs("div",{className:"mb-6",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"معلومات إضافية"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الماركة"}),r.jsx("input",{type:"text",name:"brand",value:a.brand,onChange:N,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:d})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الكود"}),r.jsx("input",{type:"text",name:"sku",value:a.sku,onChange:N,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:d})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الباركود"}),r.jsx("input",{type:"text",name:"barcode",value:a.barcode,onChange:N,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:d})]})]})]}),r.jsx("div",{className:"mb-4",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",id:"isMedicine",name:"isMedicine",checked:j,onChange:Y,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",disabled:d}),r.jsx("label",{htmlFor:"isMedicine",className:"mr-2 block text-sm font-medium text-gray-700",children:"هذا المنتج دواء"})]})}),j&&r.jsxs("div",{className:"bg-blue-50 p-6 rounded-lg border border-blue-100 mb-6",children:[r.jsx("h3",{className:"text-lg font-medium text-blue-800 mb-4",children:"معلومات الدواء"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"تاريخ الانتهاء"}),r.jsx("input",{type:"date",name:"expiryDate",value:a.expiryDate,onChange:N,min:new Date().toISOString().split("T")[0],className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:d})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الدفعة"}),r.jsx("input",{type:"text",name:"batchNumber",value:a.batchNumber,onChange:N,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:d})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الشركة المصنعة"}),r.jsx("input",{type:"text",name:"manufacturer",value:a.manufacturer,onChange:N,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:d})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",id:"requiresPrescription",name:"requiresPrescription",checked:a.requiresPrescription,onChange:N,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",disabled:d}),r.jsx("label",{htmlFor:"requiresPrescription",className:"mr-2 block text-sm font-medium text-gray-700",children:"يتطلب وصفة طبية"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المادة الفعالة"}),r.jsx("input",{type:"text",name:"activeIngredient",value:a.activeIngredient,onChange:N,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:d})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الشكل الصيدلاني"}),r.jsxs("select",{name:"dosageForm",value:a.dosageForm,onChange:N,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:d,children:[r.jsx("option",{value:"",children:"اختر الشكل الصيدلاني"}),r.jsx("option",{value:"أقراص",children:"أقراص"}),r.jsx("option",{value:"كبسولات",children:"كبسولات"}),r.jsx("option",{value:"شراب",children:"شراب"}),r.jsx("option",{value:"حقن",children:"حقن"}),r.jsx("option",{value:"كريم",children:"كريم"}),r.jsx("option",{value:"مرهم",children:"مرهم"}),r.jsx("option",{value:"لبوس",children:"لبوس"}),r.jsx("option",{value:"قطرة",children:"قطرة"}),r.jsx("option",{value:"بخاخ",children:"بخاخ"}),r.jsx("option",{value:"محلول",children:"محلول"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"التركيز"}),r.jsx("input",{type:"text",name:"strength",value:a.strength,onChange:N,placeholder:"مثال: 500mg, 10ml",className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:d})]}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ظروف التخزين"}),r.jsx("textarea",{name:"storageConditions",value:a.storageConditions,onChange:N,rows:"2",placeholder:"مثال: يحفظ في درجة حرارة أقل من 25°م",className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:d})]}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الآثار الجانبية"}),r.jsx("textarea",{name:"sideEffects",value:a.sideEffects,onChange:N,rows:"2",className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:d})]}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"موانع الاستعمال"}),r.jsx("textarea",{name:"contraindications",value:a.contraindications,onChange:N,rows:"2",className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:d})]})]})]}),r.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[r.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:d,children:"إلغاء"}),r.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 flex justify-center items-center",disabled:d,children:d?r.jsxs(r.Fragment,{children:[r.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"جاري الحفظ..."]}):n?"حفظ التغييرات":"إضافة المنتج"})]})]})]})})}):null};export{ht as P,dt as S,bt as z};
