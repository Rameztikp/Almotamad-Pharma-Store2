import{X as Ee,p as xe,f as U,o as me,j as e,Y as be,r as a,Z as Fe,$ as X,q as V,a0 as Me,a1 as es,a2 as ss,x as O,z as ts,A as rs,a3 as as,a4 as os,a5 as ns,B as Q,a6 as De,a7 as Le,a as ls,a8 as Y,a9 as is,aa as cs,ab as ds,ac as ie,ad as ce,ae as je,af as Ne,ag as ye,ah as we,ai as us,aj as Ce,ak as ms,al as _e,am as Ae,an as fs}from"./index-BUkTSXir.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],de=Ee("refresh-cw",xs);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],gs=Ee("triangle-alert",hs);function ps(t){const r=t+"CollectionProvider",[d,o]=xe(r),[h,v]=d(r,{collectionRef:{current:null},itemMap:new Map}),x=C=>{const{scope:i,children:u}=C,_=U.useRef(null),j=U.useRef(new Map).current;return e.jsx(h,{scope:i,itemMap:j,collectionRef:_,children:u})};x.displayName=r;const w=t+"CollectionSlot",R=be(w),I=U.forwardRef((C,i)=>{const{scope:u,children:_}=C,j=v(w,u),y=me(i,j.collectionRef);return e.jsx(R,{ref:y,children:_})});I.displayName=w;const n=t+"CollectionItemSlot",b="data-radix-collection-item",k=be(n),D=U.forwardRef((C,i)=>{const{scope:u,children:_,...j}=C,y=U.useRef(null),g=me(i,y),G=v(n,u);return U.useEffect(()=>(G.itemMap.set(y,{ref:y,...j}),()=>void G.itemMap.delete(y))),e.jsx(k,{[b]:"",ref:g,children:_})});D.displayName=n;function L(C){const i=v(t+"CollectionConsumer",C);return U.useCallback(()=>{const _=i.collectionRef.current;if(!_)return[];const j=Array.from(_.querySelectorAll(`[${b}]`));return Array.from(i.itemMap.values()).sort((G,$)=>j.indexOf(G.ref.current)-j.indexOf($.ref.current))},[i.collectionRef,i.itemMap])}return[{Provider:x,Slot:I,ItemSlot:D},L,o]}var vs=a.createContext(void 0);function Pe(t){const r=a.useContext(vs);return t||r||"ltr"}var ue="rovingFocusGroup.onEntryFocus",bs={bubbles:!1,cancelable:!0},ee="RovingFocusGroup",[fe,Oe,js]=ps(ee),[Ns,$e]=xe(ee,[js]),[ys,ws]=Ns(ee),qe=a.forwardRef((t,r)=>e.jsx(fe.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(fe.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(Cs,{...t,ref:r})})}));qe.displayName=ee;var Cs=a.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:d,orientation:o,loop:h=!1,dir:v,currentTabStopId:x,defaultCurrentTabStopId:w,onCurrentTabStopIdChange:R,onEntryFocus:I,preventScrollOnEntryFocus:n=!1,...b}=t,k=a.useRef(null),D=me(r,k),L=Pe(v),[C,i]=Me({prop:x,defaultProp:w??null,onChange:R,caller:ee}),[u,_]=a.useState(!1),j=es(I),y=Oe(d),g=a.useRef(!1),[G,$]=a.useState(0);return a.useEffect(()=>{const l=k.current;if(l)return l.addEventListener(ue,j),()=>l.removeEventListener(ue,j)},[j]),e.jsx(ys,{scope:d,orientation:o,dir:L,loop:h,currentTabStopId:C,onItemFocus:a.useCallback(l=>i(l),[i]),onItemShiftTab:a.useCallback(()=>_(!0),[]),onFocusableItemAdd:a.useCallback(()=>$(l=>l+1),[]),onFocusableItemRemove:a.useCallback(()=>$(l=>l-1),[]),children:e.jsx(X.div,{tabIndex:u||G===0?-1:0,"data-orientation":o,...b,ref:D,style:{outline:"none",...t.style},onMouseDown:V(t.onMouseDown,()=>{g.current=!0}),onFocus:V(t.onFocus,l=>{const ae=!g.current;if(l.target===l.currentTarget&&ae&&!u){const se=new CustomEvent(ue,bs);if(l.currentTarget.dispatchEvent(se),!se.defaultPrevented){const Z=y().filter(q=>q.focusable),oe=Z.find(q=>q.active),ne=Z.find(q=>q.id===C),te=[oe,ne,...Z].filter(Boolean).map(q=>q.ref.current);Ge(te,n)}}g.current=!1}),onBlur:V(t.onBlur,()=>_(!1))})})}),We="RovingFocusGroupItem",Ve=a.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:d,focusable:o=!0,active:h=!1,tabStopId:v,children:x,...w}=t,R=Fe(),I=v||R,n=ws(We,d),b=n.currentTabStopId===I,k=Oe(d),{onFocusableItemAdd:D,onFocusableItemRemove:L,currentTabStopId:C}=n;return a.useEffect(()=>{if(o)return D(),()=>L()},[o,D,L]),e.jsx(fe.ItemSlot,{scope:d,id:I,focusable:o,active:h,children:e.jsx(X.span,{tabIndex:b?0:-1,"data-orientation":n.orientation,...w,ref:r,onMouseDown:V(t.onMouseDown,i=>{o?n.onItemFocus(I):i.preventDefault()}),onFocus:V(t.onFocus,()=>n.onItemFocus(I)),onKeyDown:V(t.onKeyDown,i=>{if(i.key==="Tab"&&i.shiftKey){n.onItemShiftTab();return}if(i.target!==i.currentTarget)return;const u=Ts(i,n.orientation,n.dir);if(u!==void 0){if(i.metaKey||i.ctrlKey||i.altKey||i.shiftKey)return;i.preventDefault();let j=k().filter(y=>y.focusable).map(y=>y.ref.current);if(u==="last")j.reverse();else if(u==="prev"||u==="next"){u==="prev"&&j.reverse();const y=j.indexOf(i.currentTarget);j=n.loop?Ss(j,y+1):j.slice(y+1)}setTimeout(()=>Ge(j))}}),children:typeof x=="function"?x({isCurrentTabStop:b,hasTabStop:C!=null}):x})})});Ve.displayName=We;var _s={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function As(t,r){return r!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function Ts(t,r,d){const o=As(t.key,d);if(!(r==="vertical"&&["ArrowLeft","ArrowRight"].includes(o))&&!(r==="horizontal"&&["ArrowUp","ArrowDown"].includes(o)))return _s[o]}function Ge(t,r=!1){const d=document.activeElement;for(const o of t)if(o===d||(o.focus({preventScroll:r}),document.activeElement!==d))return}function Ss(t,r){return t.map((d,o)=>t[(r+o)%t.length])}var Is=qe,Rs=Ve,re="Tabs",[ks,Ws]=xe(re,[$e]),Ke=$e(),[Es,he]=ks(re),Be=a.forwardRef((t,r)=>{const{__scopeTabs:d,value:o,onValueChange:h,defaultValue:v,orientation:x="horizontal",dir:w,activationMode:R="automatic",...I}=t,n=Pe(w),[b,k]=Me({prop:o,onChange:h,defaultProp:v??"",caller:re});return e.jsx(Es,{scope:d,baseId:Fe(),value:b,onValueChange:k,orientation:x,dir:n,activationMode:R,children:e.jsx(X.div,{dir:n,"data-orientation":x,...I,ref:r})})});Be.displayName=re;var Ue="TabsList",ze=a.forwardRef((t,r)=>{const{__scopeTabs:d,loop:o=!0,...h}=t,v=he(Ue,d),x=Ke(d);return e.jsx(Is,{asChild:!0,...x,orientation:v.orientation,dir:v.dir,loop:o,children:e.jsx(X.div,{role:"tablist","aria-orientation":v.orientation,...h,ref:r})})});ze.displayName=Ue;var He="TabsTrigger",Ye=a.forwardRef((t,r)=>{const{__scopeTabs:d,value:o,disabled:h=!1,...v}=t,x=he(He,d),w=Ke(d),R=Je(x.baseId,o),I=Qe(x.baseId,o),n=o===x.value;return e.jsx(Rs,{asChild:!0,...w,focusable:!h,active:n,children:e.jsx(X.button,{type:"button",role:"tab","aria-selected":n,"aria-controls":I,"data-state":n?"active":"inactive","data-disabled":h?"":void 0,disabled:h,id:R,...v,ref:r,onMouseDown:V(t.onMouseDown,b=>{!h&&b.button===0&&b.ctrlKey===!1?x.onValueChange(o):b.preventDefault()}),onKeyDown:V(t.onKeyDown,b=>{[" ","Enter"].includes(b.key)&&x.onValueChange(o)}),onFocus:V(t.onFocus,()=>{const b=x.activationMode!=="manual";!n&&!h&&b&&x.onValueChange(o)})})})});Ye.displayName=He;var Xe="TabsContent",Ze=a.forwardRef((t,r)=>{const{__scopeTabs:d,value:o,forceMount:h,children:v,...x}=t,w=he(Xe,d),R=Je(w.baseId,o),I=Qe(w.baseId,o),n=o===w.value,b=a.useRef(n);return a.useEffect(()=>{const k=requestAnimationFrame(()=>b.current=!1);return()=>cancelAnimationFrame(k)},[]),e.jsx(ss,{present:h||n,children:({present:k})=>e.jsx(X.div,{"data-state":n?"active":"inactive","data-orientation":w.orientation,role:"tabpanel","aria-labelledby":R,hidden:!k,id:I,tabIndex:0,...x,ref:r,style:{...t.style,animationDuration:b.current?"0s":void 0},children:k&&v})})});Ze.displayName=Xe;function Je(t,r){return`${t}-trigger-${r}`}function Qe(t,r){return`${t}-content-${r}`}var Fs=Be,Ms=ze,Ds=Ye,Ls=Ze;function Ps({className:t,...r}){return e.jsx(Fs,{"data-slot":"tabs",className:O("flex flex-col gap-2",t),...r})}function Os({className:t,...r}){return e.jsx(Ms,{"data-slot":"tabs-list",className:O("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...r})}function Te({className:t,...r}){return e.jsx(Ds,{"data-slot":"tabs-trigger",className:O("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...r})}function Se({className:t,...r}){return e.jsx(Ls,{"data-slot":"tabs-content",className:O("flex-1 outline-none",t),...r})}function Ie({className:t,...r}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:O("w-full caption-bottom text-sm",t),...r})})}function Re({className:t,...r}){return e.jsx("thead",{"data-slot":"table-header",className:O("[&_tr]:border-b",t),...r})}function ke({className:t,...r}){return e.jsx("tbody",{"data-slot":"table-body",className:O("[&_tr:last-child]:border-0",t),...r})}function K({className:t,...r}){return e.jsx("tr",{"data-slot":"table-row",className:O("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...r})}function P({className:t,...r}){return e.jsx("th",{"data-slot":"table-head",className:O("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})}function F({className:t,...r}){return e.jsx("td",{"data-slot":"table-cell",className:O("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})}const $s=({isOpen:t,onClose:r,onConfirm:d,customerName:o,companyName:h,isLoading:v=!1})=>e.jsx(ts,{open:t,onOpenChange:r,children:e.jsxs(rs,{className:"sm:max-w-md bg-white border border-gray-200 shadow-lg","aria-describedby":"approval-description approval-details",children:[e.jsx(as,{children:e.jsxs(os,{className:"flex items-center gap-2 text-right",children:[e.jsx(gs,{className:"h-5 w-5 text-amber-500","aria-hidden":"true"}),e.jsx("span",{children:"تأكيد قبول طلب الترقية"})]})}),e.jsxs("div",{className:"py-4 text-right",children:[e.jsx("div",{id:"approval-description",className:"mb-4 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsx("p",{className:"text-gray-700 leading-relaxed",children:"هل أنت متأكد من قبول ترقية هذا العميل لحساب الجملة؟"})}),e.jsxs("div",{id:"approval-details",className:"space-y-2 text-sm text-gray-600",role:"region","aria-label":"تفاصيل طلب الترقية",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:o}),e.jsx("span",{children:"اسم العميل:"})]}),h&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:h}),e.jsx("span",{children:"اسم الشركة:"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"ملاحظة:"})," سيتم منح العميل صلاحية الشراء من قسم الجملة مع الاحتفاظ بنوع حسابه الأصلي (تجزئة)."]})})]}),e.jsxs(ns,{className:"flex gap-2 justify-start",children:[e.jsxs(Q,{onClick:r,variant:"outline",disabled:v,className:"flex items-center gap-2","aria-label":"إلغاء العملية",children:[e.jsx(De,{className:"h-4 w-4","aria-hidden":"true"}),"إلغاء"]}),e.jsx(Q,{onClick:d,disabled:v,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700","aria-label":"تأكيد قبول الطلب",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}),"جاري المعالجة..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"h-4 w-4"}),"تأكيد القبول"]})})]})]})}),Vs=()=>{var ge,pe,ve;const t=ls(),[r,d]=a.useState("pending"),[o,h]=a.useState([]),[v,x]=a.useState([]),[w,R]=a.useState(!0),[I,n]=a.useState(null),[b,k]=a.useState(""),[D,L]=a.useState({isVisible:!1,message:"",type:"success"}),[C,i]=a.useState(!1),[u,_]=a.useState({isOpen:!1,selectedApplication:null,isLoading:!1});a.useRef(null);const j=a.useRef(0),y=a.useRef(!0),g=a.useCallback((s,c="success")=>{L({isVisible:!0,message:s,type:c});const N=setTimeout(()=>{L(A=>({...A,isVisible:!1}))},3e3);return()=>clearTimeout(N)},[]),G=a.useCallback(()=>{L(s=>({...s,isVisible:!1}))},[]),$=a.useCallback(s=>{console.error("Authentication error:",s),g("انتهت جلسة المسؤول. يرجى تسجيل الدخول مرة أخرى","error"),setTimeout(()=>{t("/admin/login",{replace:!0})},2e3)},[t,g]),l=a.useCallback(async(s=!1)=>{var N,A,T;const c=Date.now();if(C&&!s&&c-j.current<1e3){console.log("Skipping duplicate refresh request");return}j.current=c,n(null),R(!0),i(!0);try{const m={_t:Date.now(),_cache:"no-cache"};console.log(`Fetching ${r} data with params:`,m);let M;if(r==="pending")try{M=await Y.getWholesaleApplications(m),console.log("Fetched applications:",M);const z=(f=>{if(!Array.isArray(f))return[];const E=new Map;return f.forEach(p=>{if(p&&p.id){const W={...p,id:p.id.toString(),createdAt:p.createdAt||new Date().toISOString(),status:p.status||"pending"};E.set(p.id,W)}}),Array.from(E.values())})(M);h(z)}catch(S){if(console.error("Error fetching applications:",S),((N=S.response)==null?void 0:N.status)===401){$(S);return}throw S}else if(r==="active")try{M=await Y.getWholesaleCustomers(m),console.log("Fetched customers:",M);const z=(f=>{if(!Array.isArray(f))return[];const E=new Map;return f.forEach(p=>{if(p&&p.id){const W={...p,id:p.id.toString(),createdAt:p.createdAt||new Date().toISOString()};E.set(p.id,W)}}),Array.from(E.values())})(M);x(z)}catch(S){if(console.error("Error fetching customers:",S),((A=S.response)==null?void 0:A.status)===401){$(S);return}throw S}}catch(m){console.error("Error in fetchData:",m),n("حدث خطأ في تحميل البيانات"),((T=m.response)==null?void 0:T.status)===401&&$(m)}finally{R(!1),i(!1)}},[r,C,$]),ae=a.useCallback(async()=>{var M,S,z;if(!u.selectedApplication){console.error("❌ [WholesaleCustomersPage2] No application selected for approval"),g("لم يتم تحديد طلب للموافقة","error");return}const{id:s,request_id:c,user_id:N,userName:A,companyName:T}=u.selectedApplication,m=c||s;if(!m){console.error("❌ [WholesaleCustomersPage2] Missing request ID in selected application",{selectedApplication:u.selectedApplication,availableKeys:Object.keys(u.selectedApplication)}),g("معرف الطلب غير صالح - يرجى تحديث الصفحة والمحاولة مرة أخرى","error");return}console.log("✅ [WholesaleCustomersPage2] Processing approval confirmation for:",{request_id:m,application_id:s,user_id:N,user_name:A||"غير محدد",company_name:T||"غير محدد",timestamp:new Date().toISOString()}),_(f=>({...f,isLoading:!0}));try{console.log(`🔄 [WholesaleCustomersPage2] Calling approveWholesaleUpgrade with requestId: ${m}`);const f=await Y.approveWholesaleUpgrade(m);console.log("✅ [WholesaleCustomersPage2] Approval successful:",{request_id:m,result:f,timestamp:new Date().toISOString()}),g("تمت الموافقة على طلب الترقية بنجاح","success"),_({isOpen:!1,selectedApplication:null,isLoading:!1}),await l(!0);try{console.log("🔄 [WholesaleCustomersPage2] Fetching updated wholesale customers list...");const E=await Y.getWholesaleCustomers();console.log(`✅ [WholesaleCustomersPage2] Successfully fetched ${(E==null?void 0:E.length)||0} wholesale customers`),x(E)}catch(E){console.error("❌ [WholesaleCustomersPage2] Failed to fetch wholesale customers after approval:",{error:E.message,requestId:m,timestamp:new Date().toISOString()})}}catch(f){const E={request_id:m,error:f.message,response:(M=f.response)==null?void 0:M.data,status:(S=f.response)==null?void 0:S.status,timestamp:new Date().toISOString()};console.error("❌ [WholesaleCustomersPage2] Failed to approve application:",E);let p="حدث خطأ غير متوقع",W=!1,H=!1;if(f.response?f.response.status===401?(p="انتهت جلستك. يرجى تسجيل الدخول مرة أخرى",W=!0,H=!0):f.response.status===403?p="ليس لديك صلاحيات الموافقة على طلبات الترقية":f.response.status===404?(p="الطلب غير موجود أو تم حذفه",W=!0,H=!0,h(B=>B.filter(J=>(J.request_id||J.id)!==m))):(z=f.response.data)!=null&&z.message&&(p=f.response.data.message):f.request?p="تعذر الاتصال بالخادم. يرجى التحقق من اتصال الإنترنت":f.message?f.message.includes("الطلب غير موجود")||f.message.includes("غير موجود")?(p="الطلب غير موجود أو تم حذفه",W=!0,H=!0,h(B=>B.filter(J=>(J.request_id||J.id)!==m))):f.message.includes("تم معالجة هذا الطلب مسبقاً")||f.message.includes("معالجة")?(p="تم معالجة هذا الطلب مسبقاً",W=!0,H=!0):f.message.includes("بيانات الطلب غير صالحة")&&(p="بيانات الطلب غير صالحة - يرجى تحديث الصفحة والمحاولة مرة أخرى",H=!0):p=f.message||"حدث خطأ غير متوقع",g(`فشل في الموافقة على الطلب: ${p}`,"error"),W&&_({isOpen:!1,selectedApplication:null,isLoading:!1}),H)try{await l(!0);const B=await Y.getWholesaleCustomers();x(B)}catch(B){console.error("❌ Failed to refresh data after error:",B)}}},[u,g,l]),se=a.useCallback(()=>{if(u.isLoading){console.log("⚠️ Cannot close modal while processing");return}console.log("🔄 Closing approval modal"),_({isOpen:!1,selectedApplication:null,isLoading:!1})},[u.isLoading]),Z=a.useCallback(s=>{if(!s){console.error("❌ [WholesaleCustomersPage2] No application data provided"),g("بيانات الطلب غير صحيحة","error");return}const{commercial_license:c,tax_certificate:N,...A}=s;console.log("🔍 [WholesaleCustomersPage2] Application data received:",{...A,has_commercial_license:!!c,has_tax_certificate:!!N});const T=s.request_id||s.id,m=s.user_id||s.userId;if(!T){console.error("❌ [WholesaleCustomersPage2] No valid request ID found in application",{applicationId:s.id,userId:m,availableKeys:Object.keys(s)}),g("معرف الطلب غير صالح - يرجى تحديث الصفحة والمحاولة مرة أخرى","error");return}if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(T)){const S=`❌ [WholesaleCustomersPage2] Invalid request ID format: ${T}`;console.error(S,{requestId:T,applicationId:s.id,userId:m}),g("معرف الطلب غير صالح - يرجى تحديث الصفحة","error");return}console.log("🔍 [WholesaleCustomersPage2] Processing approval for:",{request_id:T,application_id:s.id,user_id:m,company_name:s.companyName||"غير محدد",user_name:s.userName||"غير محدد"}),_({isOpen:!0,selectedApplication:{...s,id:T,request_id:T,user_id:m,userId:m},isLoading:!1})},[g]);a.useEffect(()=>{y.current=!0,l(!0);const s=setInterval(()=>{document.visibilityState==="visible"&&l(!0)},3e4);return()=>{y.current=!1,clearInterval(s)}},[r]),a.useEffect(()=>{y.current&&l(!0)},[r]);const oe=a.useCallback(async()=>{try{await l(!0),g("تم تحديث البيانات بنجاح","success")}catch{g("حدث خطأ أثناء تحديث البيانات","error")}},[l,g]),ne=a.useCallback(async(s,c="تم رفض الطلب من قبل المسؤول")=>{if(!s){g("معرف الطلب غير صالح","error");return}console.log(`🔄 Rejecting request: ${s}`);try{const N=await Y.updateRequestStatus(s,"rejected",c);console.log("✅ Rejection successful:",N),g("تم رفض الطلب بنجاح","success"),await l(!0)}catch(N){console.error("❌ Error rejecting application:",N);let A="حدث خطأ أثناء معالجة الطلب";N.message.includes("الطلب غير موجود")||N.message.includes("غير موجود")?(A="الطلب غير موجود أو تم حذفه",h(T=>T.filter(m=>m.id!==s)),await l(!0)):N.message.includes("تم معالجة هذا الطلب مسبقاً")||N.message.includes("معالجة")?(A="تم معالجة هذا الطلب مسبقاً",await l(!0)):N.message.includes("بيانات الطلب غير صالحة")?(A="بيانات الطلب غير صالحة - يرجى تحديث الصفحة والمحاولة مرة أخرى",await l(!0)):A=N.message||"حدث خطأ أثناء معالجة الطلب",g(A,"error")}},[l,g]),le=(o||[]).filter(s=>{if(!s)return!1;const c=b.toLowerCase();return(s.userName||"").toLowerCase().includes(c)||(s.userEmail||"").toLowerCase().includes(c)||(s.companyName||"").toLowerCase().includes(c)||(s.taxNumber||"").toLowerCase().includes(c)||(s.status||"").toLowerCase().includes(c)}),te=v.filter(s=>{var N,A,T,m,M;const c=b.toLowerCase();return((N=s.userName)==null?void 0:N.toLowerCase().includes(c))||((A=s.userEmail)==null?void 0:A.toLowerCase().includes(c))||((T=s.phone)==null?void 0:T.toLowerCase().includes(c))||((m=s.companyName)==null?void 0:m.toLowerCase().includes(c))||((M=s.full_name)==null?void 0:M.toLowerCase().includes(c))}),q=s=>{d(s),R(!0),n(null)};return a.useCallback(()=>{l(!0)},[l]),a.useEffect(()=>{const s=()=>{document.visibilityState==="visible"&&y.current&&l(!0)};return document.addEventListener("visibilitychange",s),()=>{document.removeEventListener("visibilitychange",s)}},[l]),e.jsxs("div",{className:"p-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"إدارة عملاء الجملة"}),e.jsx(Q,{variant:"outline",size:"icon",onClick:async s=>{const c=s.currentTarget;c.classList.add("scale-90");try{await oe()}catch(N){console.error("Error during refresh:",N)}finally{setTimeout(()=>{c.classList.remove("scale-90")},200)}},disabled:C,className:`h-10 w-10 transition-all duration-200 ease-in-out 
                      bg-white hover:bg-green-50 
                      dark:bg-white/90 dark:hover:bg-green-50/80
                      border-gray-200 dark:border-gray-300
                      active:bg-green-100 dark:active:bg-green-100
                      active:scale-95 shadow-sm
                      ${C?"text-green-600":"text-gray-800"}`,title:"تحديث البيانات",children:e.jsx(de,{className:`h-5 w-5 transition-transform ${C?"animate-spin":"group-hover:rotate-180"}`})})]}),e.jsx("div",{className:"w-full md:w-1/3",children:e.jsxs("div",{className:"relative",children:[e.jsx(is,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(cs,{placeholder:"ابحث عن عميل...",className:"pr-10 text-right w-full",value:b,onChange:s=>k(s.target.value)})]})})]}),e.jsxs(Ps,{defaultValue:"pending",value:r,onValueChange:q,className:"space-y-4",children:[e.jsxs(Os,{className:"grid w-full grid-cols-2 max-w-md mx-auto rtl:mx-0 rtl:mr-auto",children:[e.jsxs(Te,{value:"pending",className:"flex items-center justify-center rtl:flex-row-reverse gap-2 relative",children:[e.jsx(ds,{className:"h-4 w-4"}),e.jsx("span",{children:"طلبات الانتظار"}),o.length>0&&e.jsx(ie,{variant:"secondary",className:"absolute -top-2 -right-2 h-5 w-5 flex items-center justify-center p-0 rounded-full bg-red-500 text-white",children:o.length})]}),e.jsxs(Te,{value:"customers",className:"flex items-center justify-center rtl:flex-row-reverse",children:[e.jsx(ce,{className:"ml-2 h-4 w-4"}),"العملاء النشطين",e.jsx(ie,{variant:"secondary",className:"mr-2",children:v.length.toLocaleString("ar-SA")})]})]}),e.jsx(Se,{value:"pending",children:e.jsxs(je,{className:"border rounded-lg overflow-hidden",children:[e.jsx(Ne,{className:"bg-gray-50 flex flex-row justify-end flex flex-row justify-end",children:e.jsx(ye,{className:"text-lg font-semibold text-gray-800",children:"طلبات الانتظار"})}),e.jsx(we,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ie,{className:"w-full text-right rtl",children:[e.jsx(Re,{className:"bg-gray-100",children:e.jsxs(K,{children:[e.jsx(P,{className:"text-right font-bold px-4 py-3",children:"الإجراءات"}),e.jsx(P,{className:"text-right font-bold px-4 py-3",children:"تاريخ الطلب"}),e.jsx(P,{className:"text-right font-bold px-4 py-3",children:"المستندات"}),e.jsx(P,{className:"text-right font-bold px-4 py-3",children:"معلومات الشركة"}),e.jsx(P,{className:"text-right font-bold px-4 py-3",children:"معلومات العميل"})]})}),e.jsx(ke,{children:w?e.jsx(K,{children:e.jsx(F,{colSpan:5,className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-500",children:[e.jsx(de,{className:"h-4 w-4 animate-spin"}),"جاري التحميل..."]})})}):le.length>0?le.map(s=>e.jsxs(K,{className:"hover:bg-gray-50",children:[e.jsx(F,{className:"px-4 py-3 align-top border-t",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(Q,{size:"sm",className:"gap-1 bg-green-600 hover:bg-green-700 rtl:flex-row-reverse",onClick:()=>Z(s),children:[e.jsx(us,{className:"h-4 w-4"}),e.jsx("span",{children:"قبول"})]}),e.jsxs(Q,{variant:"destructive",size:"sm",className:"gap-1 rtl:flex-row-reverse",onClick:()=>ne(s.id),children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx("span",{children:"رفض"})]})]})}),e.jsx(F,{className:"px-4 py-3 align-top border-t",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:new Date(s.createdAt).toLocaleDateString("ar-SA")}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.createdAt).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})})]})}),e.jsx(F,{className:"px-4 py-3 align-top border-t",children:e.jsxs("div",{className:"space-y-2",children:[s.id_document_url&&e.jsxs("a",{href:`${"/api/v1".replace("/api","")}${s.id_document_url}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-sm text-blue-600 hover:text-blue-700 hover:underline rtl:flex-row-reverse",onClick:c=>{c.preventDefault(),window.open(`${"/api/v1".replace("/api","")}${s.id_document_url}`,"_blank","noopener,noreferrer")},children:[e.jsx(Ce,{className:"ml-2 h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:"الهوية/الإقامة"})]}),s.commercial_document_url&&e.jsxs("a",{href:`${"/api/v1".replace("/api","")}${s.commercial_document_url}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-sm text-blue-600 hover:text-blue-700 hover:underline rtl:flex-row-reverse",onClick:c=>{c.preventDefault(),window.open(`${"/api/v1".replace("/api","")}${s.commercial_document_url}`,"_blank","noopener,noreferrer")},children:[e.jsx(Ce,{className:"ml-2 h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:"السجل التجاري"})]}),!s.id_document_url&&!s.commercial_document_url&&e.jsx("span",{className:"text-sm text-gray-500",children:"لا توجد مستندات"})]})}),e.jsx(F,{className:"px-4 py-3 align-top border-t",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center rtl:flex-row-reverse",children:[e.jsx(ms,{className:"ml-2 h-4 w-4 text-primary flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:s.companyName||"غير محدد"})]}),e.jsxs("div",{className:"space-y-1 pr-6",children:[s.tax_number&&e.jsxs("div",{className:"text-sm text-gray-600 rtl:text-right",children:[e.jsx("span",{className:"text-gray-500",children:"الرقم الضريبي: "}),e.jsx("span",{className:"font-medium",children:s.tax_number})]}),s.commercial_register&&e.jsxs("div",{className:"text-sm text-gray-600 rtl:text-right",children:[e.jsx("span",{className:"text-gray-500",children:"السجل التجاري: "}),e.jsx("span",{className:"font-medium",children:s.commercial_register})]})]})]})}),e.jsx(F,{className:"px-4 py-3 align-top border-t",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-gray-900 rtl:flex-row-reverse",children:[e.jsx(ce,{className:"ml-2 h-4 w-4 text-primary flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:s.userName||"غير معروف"})]}),e.jsxs("div",{className:"space-y-1 pr-6",children:[s.userEmail&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600 rtl:flex-row-reverse",children:[e.jsx(_e,{className:"ml-2 h-3.5 w-3.5 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",title:s.userEmail,children:s.userEmail})]}),s.phone&&s.phone!==s.userEmail&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600 rtl:flex-row-reverse",children:[e.jsx(Ae,{className:"ml-2 h-3.5 w-3.5 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"ltr",children:s.phone})]})]})]})})]},s.id)):e.jsx(K,{children:e.jsx(F,{colSpan:5,className:"text-center py-8 text-gray-500",children:"لا توجد طلبات في الوقت الحالي"})})})]})})})]})}),e.jsx(Se,{value:"customers",children:e.jsxs(je,{className:"border rounded-lg overflow-hidden",children:[e.jsx(Ne,{className:"bg-gray-50",children:e.jsx(ye,{className:"text-lg font-semibold text-gray-800",children:"العملاء النشطين"})}),e.jsx(we,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ie,{className:"w-full text-right rtl",children:[e.jsx(Re,{className:"bg-gray-100",children:e.jsxs(K,{children:[e.jsx(P,{className:"text-right font-bold px-4 py-3",children:"العميل"}),e.jsx(P,{className:"text-right font-bold px-4 py-3",children:"البريد الإلكتروني"}),e.jsx(P,{className:"text-right font-bold px-4 py-3",children:"رقم الجوال"}),e.jsx(P,{className:"text-right font-bold px-4 py-3",children:"تاريخ التسجيل"}),e.jsx(P,{className:"text-right font-bold px-4 py-3",children:"الحالة"})]})}),e.jsx(ke,{children:w?e.jsx(K,{children:e.jsx(F,{colSpan:5,className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-500",children:[e.jsx(de,{className:"h-4 w-4 animate-spin"}),"جاري التحميل..."]})})}):te.length>0?te.map(s=>e.jsxs(K,{className:"hover:bg-gray-50",children:[e.jsx(F,{className:"px-4 py-3 border-t",children:e.jsxs("div",{className:"flex items-center rtl:flex-row-reverse",children:[e.jsx(ce,{className:"ml-2 h-4 w-4 text-primary flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:s.full_name||s.userName||"غير معروف"})]})}),e.jsx(F,{className:"px-4 py-3 border-t",children:e.jsxs("div",{className:"flex items-center rtl:flex-row-reverse",children:[e.jsx(_e,{className:"ml-2 h-4 w-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.userEmail||"غير متوفر"})]})}),e.jsx(F,{className:"px-4 py-3 border-t",children:e.jsxs("div",{className:"flex items-center rtl:flex-row-reverse",children:[e.jsx(Ae,{className:"ml-2 h-4 w-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"ltr",children:s.phone||"غير متوفر"})]})}),e.jsx(F,{className:"px-4 py-3 border-t",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-sm",children:new Date(s.createdAt).toLocaleDateString("ar-SA")}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.createdAt).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"})})]})}),e.jsx(F,{className:"px-4 py-3 border-t",children:e.jsx("div",{className:"flex justify-end",children:e.jsxs(ie,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:[e.jsx(Le,{className:"ml-1 h-3.5 w-3.5"}),"نشط"]})})})]},s.id)):e.jsx(K,{children:e.jsx(F,{colSpan:5,className:"text-center py-8 text-gray-500",children:"لا يوجد عملاء مسجلين"})})})]})})})]})})]}),e.jsx(fs,{isVisible:D.isVisible,message:D.message,type:D.type,onClose:G}),e.jsx($s,{isOpen:u.isOpen,onClose:se,onConfirm:ae,customerName:((ge=u.selectedApplication)==null?void 0:ge.full_name)||((pe=u.selectedApplication)==null?void 0:pe.userName)||"غير معروف",companyName:(ve=u.selectedApplication)==null?void 0:ve.company_name,isLoading:u.isLoading})]})};export{Vs as default};
