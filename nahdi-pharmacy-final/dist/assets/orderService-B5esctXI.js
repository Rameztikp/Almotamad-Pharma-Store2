import{aB as g}from"./index-ocCBIm11.js";const w=s=>({retail:"تجزئة",wholesale:"جملة"})[s]||s,S={async getRetailOrders(s=1,a=10,o="",n={}){return this.getAllOrders({page:s,limit:a,status:o,order_type:"retail",...n})},async getWholesaleOrders(s=1,a=10,o="",n={}){return this.getAllOrders({page:s,limit:a,status:o,order_type:"wholesale",...n})},async getAllOrders({page:s=1,limit:a=10,status:o="",order_type:n="",search:d="",...l}={}){try{const p=new URLSearchParams({page:s,limit:a,...o&&{status:o},...d&&{search:encodeURIComponent(d)},...n&&{order_type:n},...l}),_=await g.get(`/admin/orders?${p.toString()}`);if(!_.data)throw new Error("No data received from the server");const i=_.data,m=(Array.isArray(i==null?void 0:i.data)?i.data:Array.isArray(i==null?void 0:i.orders)?i.orders:Array.isArray(i)?i:[]).map(e=>{const f=Array.isArray(e.items)?e.items:Array.isArray(e.order_items)?e.order_items:[],r=e.shippingAddress||e.shipping_address||{},t=e.billingAddress||e.billing_address||{},A=e.createdAt||e.created_at,O=e.orderNumber||e.order_number||`ORDER-${(e.id||e._id||"").toString().substring(0,8).toUpperCase()||"UNKNOWN"}`,h=e.user||{},y=e.customerName||h.full_name||h.name||h.fullName||h.email||r.full_name||r.name||"غير محدد",b=h.email||e.customerEmail||"";return{...e,order_type:e.order_type||"retail",order_type_label:w(e.order_type||"retail"),items:f,shippingAddress:{...r,full_name:r.full_name||r.name||[r.first_name,r.last_name].filter(Boolean).join(" ").trim()||y,name:r.name||r.full_name||[r.first_name,r.last_name].filter(Boolean).join(" ").trim()||y,address:r.address||r.address_line1||r.AddressLine1||"",address_line1:r.address_line1||r.addressLine1||r.AddressLine1||r.address||"",address_line2:r.address_line2||r.addressLine2||r.AddressLine2||r.apartment||r.unit||r.flat||"",city:r.city||r.City||"",state:r.state||r.region||r.province||"",postal_code:r.postal_code||r.postalCode||r.zip||r.zipCode||"",country:r.country||"",phone:r.phone||""},billingAddress:{...t,full_name:t.full_name||t.name||[t.first_name,t.last_name].filter(Boolean).join(" ").trim()||y,name:t.name||t.full_name||[t.first_name,t.last_name].filter(Boolean).join(" ").trim()||y,address:t.address||t.address_line1||t.AddressLine1||"",address_line1:t.address_line1||t.addressLine1||t.AddressLine1||t.address||"",address_line2:t.address_line2||t.addressLine2||t.AddressLine2||t.apartment||t.unit||t.flat||"",city:t.city||t.City||"",state:t.state||t.region||t.province||"",postal_code:t.postal_code||t.postalCode||t.zip||t.zipCode||"",country:t.country||"",phone:t.phone||""},paymentMethod:e.paymentMethod||e.payment_method||"cod",status:e.status||"pending",createdAt:A||new Date().toISOString(),orderNumber:O,customerName:y,customerEmail:b,user:h}}),u=i.pagination||{};return{orders:m,totalPages:u.total_pages||i.totalPages||1,currentPage:u.page||i.currentPage||s,totalOrders:u.total||i.totalOrders||m.length}}catch(p){throw console.error("Error fetching orders:",p),p}},async getOrderDetails(s,a=""){var o,n,d,l,p,_;try{if(!s)throw new Error("Order ID is required");let i=`/admin/orders/${s}`;const c=new URLSearchParams;a&&c.append("order_type",a);const m=c.toString();m&&(i+=`?${m}`);const u=await g.get(i);if(!u.data)throw new Error("No order data received from server");const e=u.data;return{...e,_id:e._id||s,order_number:e.order_number||e.orderNumber||`ORDER-${(e._id||"").substring(0,8).toUpperCase()||"UNKNOWN"}`,order_type:e.order_type||"retail",order_type_label:this.getOrderTypeLabel(e.order_type||"retail"),status:e.status||"pending",status_label:this.getStatusLabel(e.status||"pending"),items:Array.isArray(e.items)?e.items.map(r=>{var t;return{...r,product:r.product||{},name:r.name||((t=r.product)==null?void 0:t.name)||"منتج غير معروف",price:parseFloat(r.price||0).toFixed(2),quantity:parseInt(r.quantity||1,10),total:parseFloat((r.price||0)*(r.quantity||1)).toFixed(2)}}):[],customer:e.customer||{_id:e.user_id,name:e.customerName||"عميل غير معروف",email:e.customerEmail||"لا يوجد بريد إلكتروني",phone:e.customerPhone||"لا يوجد هاتف"},shippingAddress:e.shippingAddress||{name:e.customerName||"غير محدد",address:((o=e.shippingAddress)==null?void 0:o.address)||"غير محدد",phone:((n=e.shippingAddress)==null?void 0:n.phone)||e.customerPhone||"غير محدد",city:((d=e.shippingAddress)==null?void 0:d.city)||"غير محدد",country:((l=e.shippingAddress)==null?void 0:l.country)||"المملكة العربية السعودية",postal_code:((p=e.shippingAddress)==null?void 0:p.postal_code)||"00000"},payment:e.payment||{method:e.paymentMethod||"cod",status:e.paymentStatus||(e.paymentMethod==="cod"?"pending":"unpaid"),transaction_id:e.transactionId||null,amount:e.total||0},subtotal:parseFloat(e.subtotal||((_=e.items)==null?void 0:_.reduce((r,t)=>r+parseFloat(t.price)*parseInt(t.quantity),0))||0).toFixed(2),shipping_cost:parseFloat(e.shipping_cost||e.shippingCost||0).toFixed(2),tax:parseFloat(e.tax||0).toFixed(2),discount:parseFloat(e.discount||0).toFixed(2),total:parseFloat(e.total||0).toFixed(2),created_at:e.created_at||e.createdAt||new Date().toISOString(),updated_at:e.updated_at||e.updatedAt||new Date().toISOString()}}catch(i){if(console.error(`Error fetching order ${s} details:`,i),i.response){const{status:c,data:m}=i.response;throw c===401?new Error("Your session has expired. Please log in again."):c===403?new Error("You do not have permission to view this order."):c===404?new Error("Order not found. It may have been deleted."):c===400&&m.error?new Error(m.error):new Error(`Server error: ${c} - ${m.message||"Unknown error"}`)}else throw i.request?new Error("No response from server. Please check your internet connection."):new Error(`Request error: ${i.message}`)}},async updateOrderStatus(s,a,o=""){try{if(!s)throw new Error("Order ID is required");const n=["pending","processing","shipped","delivered","cancelled"];if(!n.includes(a))throw new Error(`Invalid status. Must be one of: ${n.join(", ")}`);let d=`/admin/orders/${s}/status`;if(o){const p=new URLSearchParams;p.append("order_type",o),d+=`?${p.toString()}`}const l=await g.put(d,{status:a,updatedAt:new Date().toISOString()});if(!l.data)throw new Error("No response data received from server");return{...l.data,status:a,status_label:this.getStatusLabel(a),updatedAt:new Date().toISOString()}}catch(n){if(console.error(`Error updating order ${s} status to ${a}:`,n),n.response){const{status:d,data:l}=n.response;throw d===401?new Error("Your session has expired. Please log in again."):d===403?new Error("You do not have permission to update this order."):d===404?new Error("Order not found. It may have been deleted."):d===400&&l.error?new Error(l.error):new Error(`Server error: ${d} - ${l.message||"Unknown error"}`)}else throw n.request?new Error("No response from server. Please check your internet connection."):new Error(`Request error: ${n.message}`)}},getStatusLabel(s){return{pending:"قيد الانتظار",processing:"قيد التجهيز",shipped:"تم الشحن",delivered:"تم التوصيل",cancelled:"ملغي"}[s]||s},async notifyCustomer(s,a={}){try{if(!s)throw new Error("Order ID is required");const o=await g.post(`/admin/orders/${s}/notify`,a);return(o==null?void 0:o.data)??{ok:!0}}catch(o){throw console.warn("[adminOrderService.notifyCustomer] failed:",(o==null?void 0:o.message)||o),o}},getOrderTypeLabel(s){return{retail:{ar:"تجزئة",en:"Retail"},wholesale:{ar:"جملة",en:"Wholesale"},mixed:{ar:"مختلط",en:"Mixed"}}[s]||{ar:s,en:s}},async searchOrders(s,a=""){try{const o=new URLSearchParams({q:s,...a&&{order_type:a}}),n=await g.get(`/admin/orders/search?${o.toString()}`);return n.data&&Array.isArray(n.data)&&(n.data=n.data.map(d=>({...d,order_type_label:w(d.order_type||"retail")}))),n.data}catch(o){throw console.error("Error searching orders:",o),o}},async convertToWholesale(s){try{const a=await g.post(`/admin/orders/${s}/convert-to-wholesale`);return a.data&&(a.data.order_type_label=w("wholesale")),a.data}catch(a){throw console.error("Error converting order to wholesale:",a),a}}};export{S as a};
