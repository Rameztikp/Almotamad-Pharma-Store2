import{r as i,j as e,L as S,t as u}from"./index--DLPBvsr.js";import{n as B,B as G,H,I as J,J as R,G as W}from"./index-BjbvdVW9.js";const V=()=>{const[F,g]=i.useState([]),[U,v]=i.useState(0),[L,N]=i.useState(!0),[x,$]=i.useState(""),[h,E]=i.useState("admin"),[f,M]=i.useState("all"),[r,P]=i.useState(1),p=10,b=i.useMemo(()=>[{value:"admin",label:"مسؤول"},{value:"super_admin",label:"مشرف عام"}],[]),[m,o]=i.useState({open:!1,title:"",message:"",onConfirm:null,onCancel:null}),[q,y]=i.useState(null);i.useEffect(()=>{(async()=>{var s,l;N(!0);try{const a={page:r,limit:p,search:x||void 0,role:h!=="all"?h:void 0},n=await u.getUsers(a),_=((s=n==null?void 0:n.data)==null?void 0:s.customers)||[],D=((l=n==null?void 0:n.data)==null?void 0:l.total)||_.length,O=_.map(c=>({id:c.id,name:c.full_name||c.fullName||"-",email:c.email||"-",phone:c.phone||"-",role:c.role||"customer",account_type:c.account_type||(c.role==="wholesale"?"wholesale":"retail"),is_active:!!c.is_active,created_at:c.created_at}));g(O),v(D)}catch(a){console.error("Error fetching users:",a)}finally{N(!1)}})()},[r,p,x,h]);const A=t=>{const l=!!!t.is_active;o({open:!0,title:l?"تأكيد تفعيل المستخدم":"تأكيد تعليق المستخدم",message:`هل أنت متأكد من ${l?"تفعيل":"تعليق"} المستخدم "${t.name}"؟`,onConfirm:async()=>{try{await u.updateUserStatus(t.id,{isActive:l}),g(a=>a.map(n=>n.id===t.id?{...n,is_active:l}:n))}catch(a){console.error("Error updating user status:",a)}finally{o(a=>({...a,open:!1}))}},onCancel:()=>o(a=>({...a,open:!1}))})},T=t=>{o({open:!0,title:"تأكيد حذف المستخدم",message:"هل أنت متأكد من حذف هذا المستخدم؟ لا يمكن التراجع عن هذا الإجراء.",onConfirm:async()=>{try{await u.deleteUser(t.id),g(s=>s.filter(l=>l.id!==t.id)),v(s=>Math.max(0,s-1))}catch(s){console.error("Error deleting user:",s)}finally{o(s=>({...s,open:!1}))}},onCancel:()=>o(s=>({...s,open:!1}))})},I=(t,s)=>{var l;t.role!==s&&(y({id:t.id,newRole:s}),o({open:!0,title:"تأكيد تغيير الدور",message:`هل تريد تغيير دور المستخدم "${t.name}" إلى "${((l=b.find(a=>a.value===s))==null?void 0:l.label)||s}"؟`,onConfirm:async()=>{try{await u.updateUser(t.id,{role:s}),g(a=>a.map(n=>n.id===t.id?{...n,role:s}:n))}catch(a){console.error("Error updating user role:",a)}finally{y(null),o(a=>({...a,open:!1}))}},onCancel:()=>{y(null),o(a=>({...a,open:!1}))}}))},w=F.filter(t=>{const s=(t.name||"").toLowerCase().includes(x.toLowerCase())||(t.email||"").toLowerCase().includes(x.toLowerCase())||(t.phone||"").includes(x),l=h==="all"||t.role===h,a=f==="all"||(f==="active"?t.is_active:!t.is_active);return s&&l&&a}),C=r*p,z=C-p,k=w.slice(z,C),d=Math.max(1,Math.ceil((U||w.length)/p)),j=t=>P(t);return L?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"إدارة مستخدمي لوحة التحكم"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"عرض وإدارة حسابات المسؤولين والمشرفين"})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsxs(S,{to:"/admin/users/new",className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(B,{className:"ml-2 -mr-1"}),"إضافة مستخدم جديد"]})})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-4 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700",children:"بحث"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx(G,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",id:"search",className:"focus:ring-blue-500 focus:border-blue-500 block w-full pr-10 sm:text-sm border-gray-300 rounded-md p-2 border text-right",placeholder:"ابحث بالاسم أو البريد الإلكتروني أو الهاتف",value:x,onChange:t=>$(t.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700",children:"الدور الإداري"}),e.jsx("select",{id:"role",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",value:h,onChange:t=>E(t.target.value),children:b.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"الحالة"}),e.jsxs("select",{id:"status",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",value:f,onChange:t=>M(t.target.value),children:[e.jsx("option",{value:"all",children:"الكل"}),e.jsx("option",{value:"active",children:"نشط"}),e.jsx("option",{value:"suspended",children:"موقوف"})]})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:k.length>0?e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الاسم"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"البريد الإلكتروني"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الهاتف"}),!1,e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الدور"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الحالة"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ الانضمام"}),e.jsx("th",{scope:"col",className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"إجراءات"})})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:k.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-600",children:(t.name||"-").charAt(0)})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",t.id]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.phone}),!1,e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("select",{value:t.role,onChange:s=>I(t,s.target.value),className:"block w-full text-sm border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:b.filter(s=>s.value!=="all").map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${t.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.is_active?"نشط":"موقوف"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.created_at?new Date(t.created_at).toLocaleDateString("ar-EG"):"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end space-x-2 space-x-reverse",children:[e.jsxs(S,{to:`/admin/users/edit/${t.id}`,className:"text-blue-600 hover:text-blue-900",children:[e.jsx(H,{className:"inline ml-1"}),"تعديل"]}),e.jsx("button",{onClick:()=>A(t),className:`${t.is_active?"text-yellow-600 hover:text-yellow-900":"text-green-600 hover:text-green-900"}`,children:t.is_active?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"inline ml-1"}),"تعطيل"]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"inline ml-1"}),"تفعيل"]})}),e.jsxs("button",{onClick:()=>T(t),className:"text-red-600 hover:text-red-900",children:[e.jsx(W,{className:"inline ml-1"}),"حذف"]})]})})]},t.id))})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-gray-400",children:e.jsx("svg",{className:"h-12 w-12 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"لا يوجد مستخدمون"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"لم يتم العثور على مستخدمين يتطابقون مع معايير البحث."})]})}),d>1&&e.jsx("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:e.jsxs("div",{className:"flex-1 flex justify-between sm:justify-end",children:[e.jsx("button",{onClick:()=>j(r>1?r-1:1),disabled:r===1,className:`relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ${r===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,children:"السابق"}),e.jsx("div",{className:"hidden md:flex",children:Array.from({length:Math.min(5,d)},(t,s)=>{let l;return d<=5||r<=3?l=s+1:r>=d-2?l=d-4+s:l=r-2+s,e.jsx("button",{onClick:()=>j(l),className:`${r===l?"bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"} border-t-2 border-transparent px-4 pt-4 pb-3 text-sm font-medium`,children:l},s)})}),e.jsx("button",{onClick:()=>j(r<d?r+1:d),disabled:r===d,className:`ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ${r===d?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,children:"التالي"})]})}),m.open&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full mx-4",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 text-right",children:m.title})}),e.jsx("div",{className:"px-6 py-4 text-right text-gray-700",children:m.message}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 flex justify-end space-x-3 space-x-reverse",children:[e.jsx("button",{onClick:()=>m.onCancel&&m.onCancel(),className:"px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-md hover:bg-gray-100",children:"إلغاء"}),e.jsx("button",{onClick:()=>m.onConfirm&&m.onConfirm(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"تأكيد"})]})]})})]})};export{V as default};
