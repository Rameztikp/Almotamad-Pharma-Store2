import{aZ as z,a as R,g as q,r as d,j as e,a_ as T,aI as M,aP as B,aU as H,n as O}from"./index-ocCBIm11.js";import{Z}from"./index-D75tywyi.js";const U=()=>{const{productId:p}=z(),C=R(),{getToken:b}=q(),[F,D]=d.useState([]),[P,j]=d.useState(!0),[i,A]=d.useState(null),[s,c]=d.useState({type:"",dateFrom:"",dateTo:"",search:""}),[r,f]=d.useState(1),g=10,S=t=>{if(!t)return"";const a={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"};return new Date(t).toLocaleDateString("ar-SA",a)};d.useEffect(()=>{(async()=>{try{j(!0);const a=b(),n=await fetch(`http://localhost:8080/api/v1/products/${p}`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!n.ok)throw new Error("فشل في تحميل بيانات المنتج");const h=await n.json();A(h);const x=await fetch(`http://localhost:8080/api/v1/inventory/transactions?productId=${p}`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!x.ok)throw new Error("فشل في تحميل سجل المعاملات");const u=await x.json();D(u)}catch(a){O.error(a.message)}finally{j(!1)}})()},[p,b]);const m=F.filter(t=>{var v,k;const a=!s.type||t.transactionType===s.type,n=!s.search||((v=t.referenceNumber)==null?void 0:v.toLowerCase().includes(s.search.toLowerCase()))||((k=t.notes)==null?void 0:k.toLowerCase().includes(s.search.toLowerCase())),h=new Date(t.createdAt),x=s.dateFrom?new Date(s.dateFrom):null,u=s.dateTo?new Date(s.dateTo):null,E=(!x||h>=x)&&(!u||h<=new Date(u.getTime()+864e5));return a&&n&&E}),y=r*g,w=y-g,N=m.slice(w,y),l=Math.ceil(m.length/g),o=t=>f(t),L=()=>{c({type:"",dateFrom:"",dateTo:"",search:""}),f(1)},$=t=>({purchase:"شراء",sale:"بيع",return:"مرتجع",adjustment:"تعديل",damaged:"تالف",expired:"منتهي الصلاحية"})[t]||t,I=t=>({purchase:"bg-blue-100 text-blue-800",sale:"bg-green-100 text-green-800",return:"bg-yellow-100 text-yellow-800",adjustment:"bg-purple-100 text-purple-800",damaged:"bg-red-100 text-red-800",expired:"bg-orange-100 text-orange-800"})[t]||"bg-gray-100 text-gray-800";return P?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>C(-1),className:"flex items-center text-blue-600 hover:text-blue-800 mb-4",children:[e.jsx(T,{className:"ml-1"}),e.jsx("span",{children:"العودة"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center mb-4 md:mb-0",children:[e.jsx("div",{className:"bg-blue-100 p-3 rounded-lg mr-4",children:e.jsx(Z,{className:"text-blue-600 text-xl"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"سجل حركات المخزون"}),e.jsx("p",{className:"text-gray-600",children:i==null?void 0:i.name})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm text-gray-500 mr-2",children:"الكمية المتوفرة:"}),e.jsxs("span",{className:"text-lg font-semibold",children:[i==null?void 0:i.stockQuantity," قطعة"]})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"نوع المعاملة"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",value:s.type,onChange:t=>c({...s,type:t.target.value}),children:[e.jsx("option",{value:"",children:"الكل"}),e.jsx("option",{value:"purchase",children:"شراء"}),e.jsx("option",{value:"sale",children:"بيع"}),e.jsx("option",{value:"return",children:"مرتجع"}),e.jsx("option",{value:"adjustment",children:"تعديل"}),e.jsx("option",{value:"damaged",children:"تالف"}),e.jsx("option",{value:"expired",children:"منتهي الصلاحية"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"من تاريخ"}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",value:s.dateFrom,onChange:t=>c({...s,dateFrom:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"إلى تاريخ"}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",value:s.dateTo,onChange:t=>c({...s,dateTo:t.target.value}),min:s.dateFrom})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"بحث"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"ابحث برقم المرجع أو الملاحظات",className:"w-full pr-10 pl-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:s.search,onChange:t=>c({...s,search:t.target.value})}),e.jsx(M,{className:"absolute left-3 top-3 text-gray-400"}),(s.type||s.dateFrom||s.dateTo||s.search)&&e.jsx("button",{onClick:L,className:"absolute left-8 top-2 text-gray-400 hover:text-gray-600",title:"مسح الفلاتر",children:e.jsx(B,{className:"h-5 w-5"})})]})]})]})}),e.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"التاريخ"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"نوع المعاملة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الكمية"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"السعر"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المورد"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المرجع"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ملاحظات"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.length>0?N.map(t=>{var a;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:S(t.createdAt)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${I(t.transactionType)}`,children:$(t.transactionType)})}),e.jsxs("td",{className:`px-6 py-4 whitespace-nowrap text-sm font-medium ${t.quantity>0?"text-green-600":"text-red-600"}`,children:[t.quantity>0?"+":"",t.quantity]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.unitPrice?`${t.unitPrice.toFixed(2)} ر.س`:"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:((a=t.supplier)==null?void 0:a.name)||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.referenceNumber||"-"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 max-w-xs truncate",title:t.notes,children:t.notes||"-"})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-4 text-center text-sm text-gray-500",children:"لا توجد معاملات متطابقة مع معايير البحث"})})})]})}),l>1&&e.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>o(r>1?r-1:1),disabled:r===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"السابق"}),e.jsx("button",{onClick:()=>o(r<l?r+1:l),disabled:r===l,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"التالي"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["عرض ",e.jsx("span",{className:"font-medium",children:w+1})," إلى"," ",e.jsx("span",{className:"font-medium",children:Math.min(y,m.length)})," ","من ",e.jsx("span",{className:"font-medium",children:m.length})," نتيجة"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>o(r>1?r-1:1),disabled:r===1,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:[e.jsx("span",{className:"sr-only",children:"السابق"}),e.jsx(T,{className:"h-5 w-5","aria-hidden":"true"})]}),Array.from({length:Math.min(5,l)},(t,a)=>{let n;return l<=5||r<=3?n=a+1:r>=l-2?n=l-4+a:n=r-2+a,e.jsx("button",{onClick:()=>o(n),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${r===n?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:n},n)}),e.jsxs("button",{onClick:()=>o(r<l?r+1:l),disabled:r===l,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:[e.jsx("span",{className:"sr-only",children:"التالي"}),e.jsx(H,{className:"h-5 w-5","aria-hidden":"true"})]})]})})]})]})]})]})};export{U as default};
