import{r as o,j as e,aP as G,aK as O,aQ as Y,n as F,aR as K,aS as _,aH as T,aG as U,aT as J,t as N,g as Z,a as ee,aU as te,aV as X,aW as $,aI as se,aX as ae,aY as re}from"./index--DLPBvsr.js";import{b as R,a as W,c as L,d as ne,f as q}from"./format-DF3zju1I.js";const ie={lessThanXSeconds:{one:"أقل من ثانية واحدة",two:"أقل من ثانتين",threeToTen:"أقل من {{count}} ثواني",other:"أقل من {{count}} ثانية"},xSeconds:{one:"ثانية واحدة",two:"ثانتين",threeToTen:"{{count}} ثواني",other:"{{count}} ثانية"},halfAMinute:"نصف دقيقة",lessThanXMinutes:{one:"أقل من دقيقة",two:"أقل من دقيقتين",threeToTen:"أقل من {{count}} دقائق",other:"أقل من {{count}} دقيقة"},xMinutes:{one:"دقيقة واحدة",two:"دقيقتين",threeToTen:"{{count}} دقائق",other:"{{count}} دقيقة"},aboutXHours:{one:"ساعة واحدة تقريباً",two:"ساعتين تقريباً",threeToTen:"{{count}} ساعات تقريباً",other:"{{count}} ساعة تقريباً"},xHours:{one:"ساعة واحدة",two:"ساعتين",threeToTen:"{{count}} ساعات",other:"{{count}} ساعة"},xDays:{one:"يوم واحد",two:"يومين",threeToTen:"{{count}} أيام",other:"{{count}} يوم"},aboutXWeeks:{one:"أسبوع واحد تقريباً",two:"أسبوعين تقريباً",threeToTen:"{{count}} أسابيع تقريباً",other:"{{count}} أسبوع تقريباً"},xWeeks:{one:"أسبوع واحد",two:"أسبوعين",threeToTen:"{{count}} أسابيع",other:"{{count}} أسبوع"},aboutXMonths:{one:"شهر واحد تقريباً",two:"شهرين تقريباً",threeToTen:"{{count}} أشهر تقريباً",other:"{{count}} شهر تقريباً"},xMonths:{one:"شهر واحد",two:"شهرين",threeToTen:"{{count}} أشهر",other:"{{count}} شهر"},aboutXYears:{one:"عام واحد تقريباً",two:"عامين تقريباً",threeToTen:"{{count}} أعوام تقريباً",other:"{{count}} عام تقريباً"},xYears:{one:"عام واحد",two:"عامين",threeToTen:"{{count}} أعوام",other:"{{count}} عام"},overXYears:{one:"أكثر من عام",two:"أكثر من عامين",threeToTen:"أكثر من {{count}} أعوام",other:"أكثر من {{count}} عام"},almostXYears:{one:"عام واحد تقريباً",two:"عامين تقريباً",threeToTen:"{{count}} أعوام تقريباً",other:"{{count}} عام تقريباً"}},le=(l,g,x)=>{let m;const h=ie[l];return typeof h=="string"?m=h:g===1?m=h.one:g===2?m=h.two:g<=10?m=h.threeToTen.replace("{{count}}",String(g)):m=h.other.replace("{{count}}",String(g)),x!=null&&x.addSuffix?x.comparison&&x.comparison>0?"في خلال "+m:"منذ "+m:m},ce={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},de={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},oe={full:"{{date}} 'عند' {{time}}",long:"{{date}} 'عند' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},me={date:R({formats:ce,defaultWidth:"full"}),time:R({formats:de,defaultWidth:"full"}),dateTime:R({formats:oe,defaultWidth:"full"})},xe={lastWeek:"'أخر' eeee 'عند' p",yesterday:"'أمس عند' p",today:"'اليوم عند' p",tomorrow:"'غداً عند' p",nextWeek:"eeee 'عند' p",other:"P"},he=(l,g,x,m)=>xe[l],ue={narrow:["ق","ب"],abbreviated:["ق.م.","ب.م."],wide:["قبل الميلاد","بعد الميلاد"]},ge={narrow:["1","2","3","4"],abbreviated:["ر1","ر2","ر3","ر4"],wide:["الربع الأول","الربع الثاني","الربع الثالث","الربع الرابع"]},pe={narrow:["ي","ف","م","أ","م","ي","ي","أ","س","أ","ن","د"],abbreviated:["ينا","فبر","مارس","أبريل","مايو","يونـ","يولـ","أغسـ","سبتـ","أكتـ","نوفـ","ديسـ"],wide:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"]},ye={narrow:["ح","ن","ث","ر","خ","ج","س"],short:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],abbreviated:["أحد","اثنـ","ثلا","أربـ","خميـ","جمعة","سبت"],wide:["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"]},fe={narrow:{am:"ص",pm:"م",midnight:"ن",noon:"ظ",morning:"صباحاً",afternoon:"بعد الظهر",evening:"مساءاً",night:"ليلاً"},abbreviated:{am:"ص",pm:"م",midnight:"نصف الليل",noon:"ظهر",morning:"صباحاً",afternoon:"بعد الظهر",evening:"مساءاً",night:"ليلاً"},wide:{am:"ص",pm:"م",midnight:"نصف الليل",noon:"ظهر",morning:"صباحاً",afternoon:"بعد الظهر",evening:"مساءاً",night:"ليلاً"}},be={narrow:{am:"ص",pm:"م",midnight:"ن",noon:"ظ",morning:"في الصباح",afternoon:"بعد الظـهر",evening:"في المساء",night:"في الليل"},abbreviated:{am:"ص",pm:"م",midnight:"نصف الليل",noon:"ظهر",morning:"في الصباح",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل"},wide:{am:"ص",pm:"م",midnight:"نصف الليل",noon:"ظهر",morning:"صباحاً",afternoon:"بعد الظـهر",evening:"في المساء",night:"في الليل"}},je=l=>String(l),we={ordinalNumber:je,era:W({values:ue,defaultWidth:"wide"}),quarter:W({values:ge,defaultWidth:"wide",argumentCallback:l=>l-1}),month:W({values:pe,defaultWidth:"wide"}),day:W({values:ye,defaultWidth:"wide"}),dayPeriod:W({values:fe,defaultWidth:"wide",formattingValues:be,defaultFormattingWidth:"wide"})},Ne=/^(\d+)(th|st|nd|rd)?/i,ve=/\d+/i,Pe={narrow:/^(ق|ب)/i,abbreviated:/^(ق\.?\s?م\.?|ق\.?\s?م\.?\s?|a\.?\s?d\.?|c\.?\s?)/i,wide:/^(قبل الميلاد|قبل الميلاد|بعد الميلاد|بعد الميلاد)/i},Se={any:[/^قبل/i,/^بعد/i]},De={narrow:/^[1234]/i,abbreviated:/^ر[1234]/i,wide:/^الربع [1234]/i},ke={any:[/1/i,/2/i,/3/i,/4/i]},Te={narrow:/^[يفمأمسند]/i,abbreviated:/^(ين|ف|مار|أب|ماي|يون|يول|أغ|س|أك|ن|د)/i,wide:/^(ين|ف|مار|أب|ماي|يون|يول|أغ|س|أك|ن|د)/i},Fe={narrow:[/^ي/i,/^ف/i,/^م/i,/^أ/i,/^م/i,/^ي/i,/^ي/i,/^أ/i,/^س/i,/^أ/i,/^ن/i,/^د/i],any:[/^ين/i,/^ف/i,/^مار/i,/^أب/i,/^ماي/i,/^يون/i,/^يول/i,/^أغ/i,/^س/i,/^أك/i,/^ن/i,/^د/i]},Ce={narrow:/^[حنثرخجس]/i,short:/^(أحد|اثنين|ثلاثاء|أربعاء|خميس|جمعة|سبت)/i,abbreviated:/^(أحد|اثن|ثلا|أرب|خمي|جمعة|سبت)/i,wide:/^(الأحد|الاثنين|الثلاثاء|الأربعاء|الخميس|الجمعة|السبت)/i},Me={narrow:[/^ح/i,/^ن/i,/^ث/i,/^ر/i,/^خ/i,/^ج/i,/^س/i],wide:[/^الأحد/i,/^الاثنين/i,/^الثلاثاء/i,/^الأربعاء/i,/^الخميس/i,/^الجمعة/i,/^السبت/i],any:[/^أح/i,/^اث/i,/^ث/i,/^أر/i,/^خ/i,/^ج/i,/^س/i]},Ie={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Ee={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},We={ordinalNumber:ne({matchPattern:Ne,parsePattern:ve,valueCallback:l=>parseInt(l,10)}),era:L({matchPatterns:Pe,defaultMatchWidth:"wide",parsePatterns:Se,defaultParseWidth:"any"}),quarter:L({matchPatterns:De,defaultMatchWidth:"wide",parsePatterns:ke,defaultParseWidth:"any",valueCallback:l=>l+1}),month:L({matchPatterns:Te,defaultMatchWidth:"wide",parsePatterns:Fe,defaultParseWidth:"any"}),day:L({matchPatterns:Ce,defaultMatchWidth:"wide",parsePatterns:Me,defaultParseWidth:"any"}),dayPeriod:L({matchPatterns:Ie,defaultMatchWidth:"any",parsePatterns:Ee,defaultParseWidth:"any"})},B={code:"ar-SA",formatDistance:le,formatLong:me,formatRelative:he,localize:we,match:We,options:{weekStartsOn:0,firstWeekContainsDate:1}},Le=({isOpen:l,onClose:g,onSave:x,suppliers:m=[],products:h=[]})=>{const[d,D]=o.useState({supplierId:"",invoiceNumber:"",invoiceDate:new Date().toISOString().split("T")[0],notes:"",items:[{productId:"",quantity:1,unitPrice:0,expiryDate:"",batchNumber:"",total:0}]}),[u,w]=o.useState(""),[v,C]=o.useState(h),[b,p]=o.useState(!1);o.useEffect(()=>{if(u){const n=h.filter(i=>i.name.toLowerCase().includes(u.toLowerCase())||i.barcode&&i.barcode.includes(u));C(n)}else C(h)},[u,h]);const k=n=>{const{name:i,value:s}=n.target;D(t=>({...t,[i]:s}))},c=(n,i,s)=>{const t=[...d.items];if(t[n]={...t[n],[i]:s},i==="unitPrice"||i==="quantity"){const y=i==="quantity"?parseFloat(s)||0:parseFloat(t[n].quantity)||0,z=i==="unitPrice"?parseFloat(s)||0:parseFloat(t[n].unitPrice)||0;t[n].total=(y*z).toFixed(2)}D(y=>({...y,items:t}))},P=()=>{D(n=>({...n,items:[...n.items,{productId:"",quantity:1,unitPrice:0,expiryDate:"",batchNumber:"",total:0}]}))},M=n=>{if(d.items.length>1){const i=d.items.filter((s,t)=>t!==n);D(s=>({...s,items:i}))}},j=async n=>{n.preventDefault(),p(!0);try{const i=d.items.reduce((t,y)=>t+(parseFloat(y.total)||0),0),s={...d,totalAmount:i,items:d.items.map(t=>({...t,quantity:parseFloat(t.quantity),unitPrice:parseFloat(t.unitPrice),total:parseFloat(t.total)}))};await x(s),F.success("تم حفظ الفاتورة بنجاح"),g()}catch(i){console.error("Error saving invoice:",i),F.error("حدث خطأ أثناء حفظ الفاتورة")}finally{p(!1)}};return l?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"فاتورة مشتريات جديدة"}),e.jsx("button",{onClick:g,className:"text-gray-500 hover:text-gray-700",children:e.jsx(G,{size:24})})]}),e.jsxs("form",{onSubmit:j,className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["المورد ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"supplierId",value:d.supplierId,onChange:k,className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"اختر المورد"}),m.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الفاتورة"}),e.jsx("input",{type:"text",name:"invoiceNumber",value:d.invoiceNumber,onChange:k,className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"رقم الفاتورة"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"تاريخ الفاتورة"}),e.jsx("input",{type:"date",name:"invoiceDate",value:d.invoiceDate,onChange:k,className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملاحظات"}),e.jsx("input",{type:"text",name:"notes",value:d.notes,onChange:k,className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"ملاحظات إضافية"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-medium",children:"تفاصيل المنتجات"}),e.jsxs("button",{type:"button",onClick:P,className:"flex items-center text-sm text-blue-600 hover:text-blue-800",children:[e.jsx(O,{className:"ml-1"})," إضافة منتج"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"المنتج"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"الكمية"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"سعر الوحدة"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"تاريخ الانتهاء"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"الرقم التسلسلي"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"المجموع"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.items.map((n,i)=>{var s;return e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:u,onChange:t=>w(t.target.value),className:"w-full p-2 border rounded",placeholder:"ابحث عن منتج..."}),u&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-md shadow-lg max-h-60 overflow-y-auto",children:[v.map(t=>e.jsxs("div",{className:"p-2 hover:bg-gray-100 cursor-pointer",onClick:()=>{h.find(y=>y.id===t.id),c(i,"productId",t.id),c(i,"unitPrice",t.purchasePrice||0),w("")},children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.barcode&&`باركود: ${t.barcode}`})]},t.id)),v.length===0&&e.jsx("div",{className:"p-2 text-gray-500",children:"لا توجد نتائج"})]})]}),n.productId&&e.jsx("div",{className:"mt-1 text-sm text-gray-600",children:(s=h.find(t=>t.id===n.productId))==null?void 0:s.name})]}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",min:"1",value:n.quantity,onChange:t=>c(i,"quantity",t.target.value),className:"w-20 p-1 border rounded text-center"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",step:"0.01",min:"0",value:n.unitPrice,onChange:t=>c(i,"unitPrice",t.target.value),className:"w-24 p-1 border rounded text-left"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"date",value:n.expiryDate,onChange:t=>c(i,"expiryDate",t.target.value),className:"w-32 p-1 border rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"text",value:n.batchNumber,onChange:t=>c(i,"batchNumber",t.target.value),className:"w-24 p-1 border rounded",placeholder:"رقم الدفعة"})}),e.jsxs("td",{className:"px-4 py-2 text-gray-700",children:[parseFloat(n.total||0).toFixed(2)," ر.س"]}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("button",{type:"button",onClick:()=>M(i),className:"text-red-500 hover:text-red-700",disabled:d.items.length<=1,children:e.jsx(Y,{})})})]},i)})}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"5",className:"text-left font-medium px-4 py-2",children:"الإجمالي"}),e.jsxs("td",{className:"px-4 py-2 font-bold text-lg",children:[d.items.reduce((n,i)=>n+(parseFloat(i.total)||0),0).toFixed(2)," ر.س"]}),e.jsx("td",{})]})})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:g,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50",disabled:b,children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:b||!d.supplierId||d.items.length===0,children:b?"جاري الحفظ...":"حفظ الفاتورة"})]})]})]})}):null},ze=({supplier:l,onClose:g})=>{var n,i;const{getToken:x}=useAuth(),[m,h]=o.useState([]),[d,D]=o.useState(!0),[u,w]=o.useState({startDate:new Date(new Date().setMonth(new Date().getMonth()-1)),endDate:new Date}),[v,C]=o.useState({type:"all"}),b=s=>q(new Date(s),"yyyy-MM-dd"),p=s=>new Intl.NumberFormat("ar-SA",{style:"currency",currency:"SAR",minimumFractionDigits:2}).format(s);o.useEffect(()=>{(async()=>{if(l!=null&&l.id)try{D(!0);const t={startDate:b(u.startDate),endDate:b(u.endDate),type:v.type==="all"?"":v.type},y=await N.getSupplierTransactions(l.id,t);if(y.success)h(y.data||[]);else throw new Error(y.message||"فشل في تحميل كشف الحساب")}catch(t){console.error("Error fetching transactions:",t),F.error(t.message||"حدث خطأ أثناء تحميل كشف الحساب")}finally{D(!1)}})()},[l==null?void 0:l.id,u,v]);const k=()=>{let s=0;return m.map(t=>(t.type==="purchase"?s+=t.amount:t.type==="payment"&&(s-=t.amount),{...t,balance:s})).reverse()},c=()=>{window.print()};if(!l)return null;const P=k(),M=((n=P[0])==null?void 0:n.balance)||0,j=((i=P[P.length-1])==null?void 0:i.balance)||0;return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 print:p-0 print:shadow-none",children:[e.jsxs("div",{className:"flex justify-between items-start mb-8 print:flex-col print:items-center print:mb-4",children:[e.jsxs("div",{className:"text-right print:text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"كشف حساب المورد"}),e.jsx("h3",{className:"text-xl text-gray-600",children:l.name}),e.jsx("p",{className:"text-gray-500",children:l.phone}),l.email&&e.jsx("p",{className:"text-gray-500",children:l.email})]}),e.jsxs("div",{className:"flex space-x-3 space-x-reverse print:hidden",children:[e.jsxs("button",{onClick:c,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:[e.jsx(K,{className:"ml-2"}),"طباعة"]}),e.jsx("button",{onClick:g,className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50",children:"إغلاق"})]})]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg mb-6 print:hidden",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"من تاريخ"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:b(u.startDate),onChange:s=>w(t=>({...t,startDate:new Date(s.target.value)})),className:"w-full p-2 border rounded-md"}),e.jsx(_,{className:"absolute right-3 top-3 text-gray-400"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"إلى تاريخ"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:b(u.endDate),onChange:s=>w(t=>({...t,endDate:new Date(s.target.value)})),className:"w-full p-2 border rounded-md"}),e.jsx(_,{className:"absolute right-3 top-3 text-gray-400"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"نوع الحركة"}),e.jsxs("select",{value:v.type,onChange:s=>C({...v,type:s.target.value}),className:"w-full p-2 border rounded-md",children:[e.jsx("option",{value:"all",children:"الكل"}),e.jsx("option",{value:"purchase",children:"مشتريات"}),e.jsx("option",{value:"payment",children:"مدفوعات"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 print:grid-cols-3 print:gap-2",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"الرصيد الافتتاحي"}),e.jsx("p",{className:"text-xl font-semibold",children:p(M)})]}),e.jsx("div",{className:"p-2 bg-blue-100 rounded-full text-blue-600",children:e.jsx(T,{size:20})})]})}),e.jsx("div",{className:"bg-green-50 p-4 rounded-lg border-l-4 border-green-500",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي المشتريات"}),e.jsx("p",{className:"text-xl font-semibold",children:p(m.filter(s=>s.type==="purchase").reduce((s,t)=>s+t.amount,0))})]}),e.jsx("div",{className:"p-2 bg-green-100 rounded-full text-green-600",children:e.jsx(U,{size:20})})]})}),e.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-500",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي المدفوعات"}),e.jsx("p",{className:"text-xl font-semibold",children:p(m.filter(s=>s.type==="payment").reduce((s,t)=>s+t.amount,0))})]}),e.jsx("div",{className:"p-2 bg-yellow-100 rounded-full text-yellow-600",children:e.jsx(J,{size:20})})]})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"التاريخ"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"نوع الحركة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الرقم المرجعي"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الوصف"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المدين"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الدائن"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الرصيد"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-4 text-center",children:"جاري التحميل..."})}):P.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-4 text-center text-gray-500",children:"لا توجد حركات في الفترة المحددة"})}):P.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:q(new Date(s.date),"yyyy/MM/dd",{locale:B})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${s.type==="purchase"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:s.type==="purchase"?"فاتورة مشتريات":"سند صرف"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.reference_number||"--"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:s.description||"--"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.type==="purchase"?p(s.amount):"--"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.type==="payment"?p(s.amount):"--"}),e.jsx("td",{className:`px-6 py-4 whitespace-nowrap text-sm font-medium ${s.balance<0?"text-red-600":"text-green-600"}`,children:p(s.balance)})]},s.id))}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-6 py-3 text-right text-sm font-medium text-gray-900",children:"الرصيد الختامي"}),e.jsx("td",{className:"px-6 py-3 text-right text-sm font-medium text-gray-900",children:j>0?p(j):"--"}),e.jsx("td",{className:"px-6 py-3 text-right text-sm font-medium text-gray-900",children:j<0?p(Math.abs(j)):"--"}),e.jsx("td",{className:"px-6 py-3 text-right text-sm font-medium text-gray-900",children:e.jsx("span",{className:j<0?"text-red-600":"text-green-600",children:p(j)})})]})})]})}),e.jsx("div",{className:"hidden print:block mt-8 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsxs("p",{children:["تاريخ الطباعة: ",q(new Date,"yyyy/MM/dd",{locale:B})]}),e.jsx("p",{children:"اسم المستخدم: [اسم المستخدم]"})]}),e.jsxs("div",{className:"text-sm text-gray-500 text-left",children:[e.jsx("p",{children:"برنامج إدارة الصيدلية"}),e.jsx("p",{children:"هاتف: [رقم الهاتف]"})]})]})})]})},qe=()=>{const{getToken:l}=Z(),g=ee(),[x,m]=o.useState([]),[h,d]=o.useState([]),[D,u]=o.useState(!0),[w,v]=o.useState(""),[C,b]=o.useState(!1),[p,k]=o.useState(!1),[c,P]=o.useState(null),[M,j]=o.useState([]),[n,i]=o.useState("suppliers");o.useEffect(()=>{(async()=>{try{if(u(!0),n==="suppliers"||!c){const[r,f]=await Promise.all([N.getSuppliers(),N.getInventory()]);if(r.success)m(r.data||[]);else throw new Error(r.message||"فشل في تحميل بيانات الموردين");if(f.success)d(f.data||[]);else throw new Error(f.message||"فشل في تحميل المنتجات")}else if(c){const r=await N.getPurchaseInvoices({supplier_id:c.id});if(r.success)j(r.data||[]);else throw new Error(r.message||"فشل في تحميل فواتير المشتريات")}}catch(r){F.error(r.message)}finally{u(!1)}})()},[n,c]);const s=async a=>{try{const r=l(),f=await N.createPurchaseInvoice(a);if(f.success){const[S,I]=await Promise.all([N.getSuppliers(),N.getInventory()]);if(S.success)m(S.data||[]);else throw new Error(S.message||"فشل في تحميل بيانات الموردين");if(I.success)d(I.data||[]);else throw new Error(I.message||"فشل في تحميل المنتجات");if(c){const A=await N.getPurchaseInvoices({supplier_id:c.id});if(A.success)j(A.data||[]);else throw new Error(A.message||"فشل في تحميل فواتير المشتريات")}return F.success("تم حفظ الفاتورة بنجاح"),!0}else throw new Error(f.message||"فشل في حفظ الفاتورة")}catch(r){return F.error(r.message),!1}},t=a=>{P(a),i("invoices")},y=async a=>{if(window.confirm("هل أنت متأكد من حذف هذه الفاتورة؟ سيتم خصم المبلغ من رصيد المورد."))try{const r=await N.deletePurchaseInvoice(a);if(r.success){const[f,S]=await Promise.all([N.getSuppliers(),N.getPurchaseInvoices({supplier_id:c.id})]);if(f.success)m(f.data||[]);else throw new Error(f.message||"فشل في تحميل بيانات الموردين");if(S.success)j(S.data||[]);else throw new Error(S.message||"فشل في تحميل فواتير المشتريات");F.success("تم حذف الفاتورة بنجاح")}else throw new Error(r.message||"فشل في حذف الفاتورة")}catch(r){console.error("Error deleting invoice:",r),F.error(r.message||"حدث خطأ أثناء حذف الفاتورة")}},z=a=>new Date(a).toLocaleDateString("ar-SA"),V=x.filter(a=>{var r,f,S,I;return((r=a.name)==null?void 0:r.toLowerCase().includes(w.toLowerCase()))||((f=a.contactPerson)==null?void 0:f.toLowerCase().includes(w.toLowerCase()))||((S=a.phone)==null?void 0:S.includes(w))||((I=a.email)==null?void 0:I.toLowerCase().includes(w.toLowerCase()))}),E=a=>new Intl.NumberFormat("ar-SA",{style:"currency",currency:"SAR",minimumFractionDigits:2}).format(a||0);if(D)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})});const H=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>i("suppliers"),className:"flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx(te,{className:"ml-1"}),"العودة إلى قائمة الموردين"]}),e.jsxs("h2",{className:"text-xl font-semibold",children:["فواتير المشتريات - ",c==null?void 0:c.name]}),e.jsx("div",{className:"w-32"})," "]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"رقم الفاتورة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"التاريخ"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"عدد الأصناف"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الإجمالي"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ملاحظات"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الإجراءات"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:M.length>0?M.map(a=>{var r;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:a.invoice_number||"--"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:z(a.invoice_date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:((r=a.items)==null?void 0:r.length)||0}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[parseFloat(a.total_amount).toFixed(2)," ر.س"]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 max-w-xs truncate",children:a.notes||"--"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>g(`/admin/invoices/${a.id}`),className:"text-blue-600 hover:text-blue-900 mr-4",title:"عرض التفاصيل",children:e.jsx(X,{size:18})}),e.jsx("button",{onClick:()=>y(a.id),className:"text-red-600 hover:text-red-900",title:"حذف الفاتورة",children:e.jsx(Y,{size:18})})]})]},a.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-4 text-center text-sm text-gray-500",children:"لا توجد فواتير مسجلة لهذا المورد"})})})]})})})]}),Q=()=>e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"أرصدة الموردين"}),e.jsxs("div",{className:"flex space-x-3 space-x-reverse w-full md:w-auto",children:[e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(O,{className:"ml-1"}),"فاتورة مشتريات جديدة"]}),e.jsxs("button",{onClick:()=>{},className:"flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx($,{className:"ml-1"}),"كشف حساب المورد"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx("input",{type:"text",placeholder:"ابحث عن مورد...",className:"w-full pr-10 pl-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:w,onChange:a=>v(a.target.value)}),e.jsx(se,{className:"absolute left-3 top-3 text-gray-400"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المورد"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الفواتير"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"معلومات الاتصال"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الرصيد الحالي"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"آخر معاملة"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:V.length>0?V.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(T,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.name}),e.jsx("div",{className:"text-sm text-gray-500",children:a.contactPerson||"لا يوجد"})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsxs("button",{onClick:()=>t(a),className:"text-blue-600 hover:text-blue-900 px-3 py-1 text-sm border border-blue-200 rounded-md hover:bg-blue-50",children:[e.jsx(X,{className:"inline ml-1"}),"الفواتير"]}),e.jsxs("button",{onClick:()=>{P(a),k(!0)},className:"text-green-600 hover:text-green-900 px-3 py-1 text-sm border border-green-200 rounded-md hover:bg-green-50",children:[e.jsx($,{className:"inline ml-1"}),"كشف حساب"]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"text-sm text-gray-900",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(ae,{className:"ml-1 text-gray-500"}),e.jsx("span",{children:a.phone||"غير متوفر"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"ml-1 text-gray-500"}),e.jsx("span",{children:a.email||"غير متوفر"})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-3 py-1 inline-flex text-sm leading-5 font-semibold rounded-full ${(a.balance||0)<0?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:E(a.balance)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.lastTransactionDate?new Date(a.lastTransactionDate).toLocaleDateString("ar-SA"):"لا توجد معاملات سابقة"})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-6 py-4 text-center text-sm text-gray-500",children:"لا توجد نتائج مطابقة للبحث"})})})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-8",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-blue-100 text-blue-600",children:e.jsx(T,{className:"h-6 w-6"})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"إجمالي المديونيات"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:E(x.reduce((a,r)=>a+(r.balance<0?Math.abs(r.balance):0),0))})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-green-100 text-green-600",children:e.jsx(T,{className:"h-6 w-6"})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"إجمالي الأرصدة"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:E(x.reduce((a,r)=>a+(r.balance>0?r.balance:0),0))})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-yellow-100 text-yellow-600",children:e.jsx(T,{className:"h-6 w-6"})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"إجمالي الموردين"}),e.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[x.length," مورد"]})]})]})})]})]});return e.jsxs("div",{className:"p-6",children:[n==="suppliers"?e.jsxs(e.Fragment,{children:[Q(),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-8",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-blue-100 text-blue-600",children:e.jsx(T,{className:"h-6 w-6"})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"إجمالي المديونيات"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:E(x.reduce((a,r)=>a+(r.balance<0?Math.abs(r.balance):0),0))})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-green-100 text-green-600",children:e.jsx(T,{className:"h-6 w-6"})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"إجمالي الأرصدة"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:E(x.reduce((a,r)=>a+(r.balance>0?r.balance:0),0))})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-yellow-100 text-yellow-600",children:e.jsx(T,{className:"h-6 w-6"})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"إجمالي الموردين"}),e.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[x.length," مورد"]})]})]})})]})]}):H(),e.jsx(Le,{isOpen:C,onClose:()=>b(!1),onSave:async a=>{const r=await s(a);return r&&b(!1),r},suppliers:x,products:h,defaultSupplierId:c==null?void 0:c.id}),p&&c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg w-full max-w-6xl max-h-[90vh] overflow-auto",children:e.jsx(ze,{supplier:c,onClose:()=>k(!1)})})})]})};export{qe as default};
