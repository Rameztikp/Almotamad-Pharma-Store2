import{r as i,a as Ne,j as s,B as C,z as c,v as ve,w as ke,x as Se,y as _e,A as Ce,D as Pe,E as De,F as Ee}from"./index-CyoFg3u4.js";import{A as se,B as Fe,C as f,y as P,D as te,E as Ae,G as Ie}from"./index-Bm7XRX9C.js";import{S as Le,P as Ue,A as D,a as E,b as F,c as A,d as I,e as L,f as U}from"./alert-dialog-BbNyPUJQ.js";import"./index-pXtBN6HF.js";const He=()=>{const[y,d]=i.useState([]),[O,W]=i.useState([]),[ae,$]=i.useState(!1),[R,x]=i.useState([]),[q,re]=i.useState(""),[B,le]=i.useState("all"),[M,j]=i.useState(!1),[h,w]=i.useState(null),[Oe,z]=i.useState(!0),[We,G]=i.useState(!1),[$e,ie]=i.useState([]),[H,ne]=i.useState({}),[Re,qe]=i.useState({}),[n,T]=i.useState(null),[oe,N]=i.useState(!1),[g,J]=i.useState(!1),[ce,v]=i.useState(!1),[u,K]=i.useState(null),[p,Q]=i.useState(!1),[m,V]=i.useState(!1),[o,X]=i.useState(null),[de,k]=i.useState(!1);Ne();const xe=(e,t)=>{var a,r;t&&(t.preventDefault(),t.stopPropagation(),(r=(a=t.nativeEvent)==null?void 0:a.stopImmediatePropagation)==null||r.call(a)),T(e),N(!0)},ue=e=>{K(e),v(!0)},he=e=>{Y(e)?(X(e),k(!0)):c("المنتج غير منشور بالفعل",{icon:"⚠️",style:{borderRadius:"10px",background:"#f8fafc",color:"#0f172a"}})},ge=async e=>{if(u)try{Q(!0),await _e(u.id,e,a=>{d(a),x(a)})&&(await b(),await S())}catch(t){console.error("Error publishing product:",t)}finally{Q(!1),v(!1),K(null)}},me=async()=>{if(o)try{V(!0);const e=y.findIndex(l=>l.id===o.id);if(e===-1)return;const t={...o,is_published:!1,published_at:null,status:"inactive",is_active:!1,published_wholesale:!1,is_published_wholesale:!1},a=[...y];if(a[e]=t,d(a),x(a),await Ce(o.id,"wholesale",l=>{d(l),x(l)})){console.log("Unpublish successful, refreshing data...");try{await b(),await S(),c.success("تم إلغاء نشر المنتج بنجاح",{position:"top-center",duration:3e3})}catch(l){console.error("Error refreshing data after unpublish:",l)}}else d(l=>[...l]),x(l=>[...l]),c.error("فشل إلغاء نشر المنتج. يرجى المحاولة مرة أخرى",{position:"top-center",duration:3e3})}catch(e){console.error("Error unpublishing product:",e),c.error("حدث خطأ أثناء محاولة إلغاء نشر المنتج",{position:"top-center",duration:3e3}),console.error("Error in handleUnpublish:",e),d(t=>[...t]),x(t=>[...t]),c.error(e.message||"حدث خطأ أثناء محاولة إلغاء نشر المنتج",{position:"top-center",duration:3e3})}finally{V(!1),k(!1),X(null)}},fe=async()=>{if(n){J(!0);try{console.log("Attempting to delete product:",n.id);const e=await Se(n.id);if(console.log("Delete response:",e),e&&e.success){const t=y.filter(a=>a.id!==n.id);d(t),x(t),c.success(e.message||"تم حذف المنتج بنجاح",{position:"top-center",duration:3e3})}else throw new Error((e==null?void 0:e.error)||"فشل حذف المنتج")}catch(e){console.error("Error in confirmDelete:",e),c.error(e.message||"حدث خطأ أثناء حذف المنتج",{position:"top-center",duration:3e3})}finally{J(!1),N(!1),T(null)}}},pe=()=>{c.success("This is a test notification",{position:"top-center",duration:5e3})},be=async()=>{try{$(!0);const e=await De.getWholesaleCategories();console.log("Raw categories response:",e);let t=[];Array.isArray(e)?t=e:e&&Array.isArray(e.data)?t=e.data:e&&e.data&&typeof e.data=="object"&&(t=Object.values(e.data)),console.log("Processed categories:",t),W(t||[])}catch(e){console.error("Error fetching categories:",e),c.error("حدث خطأ أثناء جلب الأقسام"),W([])}finally{$(!1)}},ye=e=>{if(!e)return console.log("❌ No image path provided"),null;const t="http://localhost:8080";if(e.startsWith("http")||e.startsWith("blob:"))return console.log("✅ Using full URL:",e),e;const a=[`${t}${e.startsWith("/")?"":"/"}${e}`,`${t}/uploads/${e.replace(/^\/+/,"")}`,`${t}/api/v1/uploads/${e.replace(/^\/+/,"")}`,`${t}/public/uploads/${e.replace(/^\/+/,"")}`];console.log("🔄 Trying possible image paths for",e,":",a);const r=a[0];return console.log("📤 Using image URL:",r),r},b=async()=>{try{z(!0),console.log("Fetching wholesale products...");const a=((await Pe({limit:1e3})).data||[]).filter(r=>r&&(r.type==="wholesale"||r.product_type==="wholesale"||r.is_wholesale===!0));return d(a),x(a),a}catch(e){return console.error("Error fetching products:",e),c.error("حدث خطأ أثناء جلب المنتجات"),[]}finally{z(!1)}},S=async()=>{try{G(!0);const e=await Ee(1,1e3);e&&e.data&&ie(e.data)}catch(e){console.error("Error fetching published wholesale products:",e)}finally{G(!1)}},Y=e=>e?e.published_wholesale===!0||e.is_published_wholesale===!0||e.status==="published"||e.is_published===!0:!1;i.useEffect(()=>{(async()=>{try{await Promise.all([b(),be()]),await S()}catch(t){console.error("Error loading data:",t),c.error("حدث خطأ أثناء تحميل البيانات")}})()},[]);const Z=(e,t)=>{let a=[...y];if(e){const r=e.toLowerCase();a=a.filter(l=>(l.name_ar||l.name||"").toLowerCase().includes(r)||(l.description_ar||l.description||"").toLowerCase().includes(r)||(l.barcode||"").includes(e))}t&&t!=="all"&&(a=a.filter(r=>r.category_id==t)),x(a)},je=e=>{w(e),j(!0)},we=async e=>{var t,a;try{const r={...e,type:"wholesale",category_id:e.category_id||(h==null?void 0:h.category_id),stock_quantity:parseInt(e.stock_quantity||e.stock||0,10),min_stock_level:parseInt(e.min_stock_level||5,10)};console.log("Submitting product data:",r);let l;h?(l=await ve(h.id,r),c.success("تم تحديث المنتج بنجاح")):(l=await ke(r),console.log("Product created:",l),c.success("تمت إضافة المنتج بنجاح")),j(!1),w(null),l?(d(ee=>h?ee.map(_=>_.id===l.id?{..._,...l}:_):[l,...ee]),await b()):await b()}catch(r){console.error("Error saving product:",r),c.error(((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"حدث خطأ أثناء حفظ المنتج")}};return s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"منتجات الجملة"}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs("button",{onClick:pe,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center",children:[s.jsx(se,{className:"ml-2"}),"اختبار الإشعار"]}),s.jsxs("button",{onClick:()=>{w(null),j(!0)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center",children:[s.jsx(se,{className:"ml-2"}),"إضافة منتج جديد"]})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:s.jsx(Fe,{className:"text-gray-400"})}),s.jsx("input",{type:"text",placeholder:"ابحث عن منتج...",className:"w-full pr-10 pl-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:q,onChange:e=>{re(e.target.value),Z(e.target.value,B)}})]}),s.jsx("div",{className:"w-full md:w-64",children:s.jsx(Le,{options:[{value:"all",label:"جميع الفئات"},...O.map(e=>({value:e.id,label:e.name_ar||e.name}))],value:B,onChange:e=>{le(e),Z(q,e)},placeholder:"اختر فئة",loading:ae,noOptionsMessage:"لا توجد فئات متاحة"})})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الصورة"}),s.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"اسم المنتج"}),s.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الفئة"}),s.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"السعر"}),s.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الكمية"}),s.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الحالة"}),s.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الإجراءات"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:R.length>0?R.map(e=>{var t,a;return s.jsxs("tr",{children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("div",{className:"flex items-center justify-center",children:!H[e.id]&&(e.image_url||e.images&&e.images[0])?s.jsx("div",{className:"h-10 w-10 rounded-full overflow-hidden border border-gray-200 flex-shrink-0",children:s.jsx("img",{src:ye(e.image_url||e.images&&e.images[0]),alt:e.name,className:"h-full w-full object-cover",onError:r=>{e.image_url||e.images&&e.images[0],ne(l=>({...l,[e.id]:!0}))}})}):s.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 border border-gray-200 flex items-center justify-center flex-shrink-0",children:s.jsx("span",{className:"text-gray-400 text-xs text-center px-1",children:H[e.id]?"خطأ":"لا توجد"})})})}),s.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),s.jsxs("div",{className:"text-sm text-gray-500",children:[(t=e.description)==null?void 0:t.substring(0,30),"..."]})]}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:((a=O.find(r=>r.id===e.category_id))==null?void 0:a.name)||"غير مصنف"})}),s.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[e.price," ر.س"]}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.stock_quantity}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.published_wholesale===!0||e.is_published_wholesale===!0?s.jsx("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800",children:"منشور"}):s.jsx("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800",children:"غير منشور"})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:s.jsxs("div",{className:"flex items-center justify-end space-x-3",children:[Y(e)?s.jsx("button",{type:"button",onClick:()=>he(e),className:"text-yellow-600 hover:text-yellow-900 transition duration-150 ease-in-out p-1",title:"إلغاء نشر المنتج",disabled:m&&(o==null?void 0:o.id)===e.id,children:m&&(o==null?void 0:o.id)===e.id?s.jsx(f,{className:"animate-spin"}):s.jsxs("div",{className:"flex items-center",children:[s.jsx(P,{className:"ml-1"}),s.jsx("span",{children:"إلغاء النشر"})]})}):s.jsx("button",{type:"button",onClick:()=>ue(e),className:"text-green-600 hover:text-green-900 transition duration-150 ease-in-out p-1",title:"نشر المنتج",disabled:p&&(u==null?void 0:u.id)===e.id,children:p&&(u==null?void 0:u.id)===e.id?s.jsx(f,{className:"animate-spin"}):s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{className:"ml-1"}),s.jsx("span",{children:"نشر"})]})}),s.jsx("button",{type:"button",onClick:()=>je(e),className:"text-indigo-600 hover:text-indigo-900 transition duration-150 ease-in-out",title:"تعديل المنتج",children:s.jsx(Ae,{})}),s.jsx("button",{type:"button",onClick:r=>xe(e,r),className:"text-red-600 hover:text-red-900 transition duration-150 ease-in-out",title:"حذف المنتج",disabled:g&&(n==null?void 0:n.id)===e.id,children:g&&(n==null?void 0:n.id)===e.id?s.jsx(f,{className:"animate-spin"}):s.jsx(Ie,{})})]})})]},e.id)}):s.jsx("tr",{children:s.jsx("td",{colSpan:"6",className:"px-6 py-4 text-center text-gray-500",children:"لا توجد منتجات متاحة"})})})]})})]}),M&&s.jsx(Ue,{isOpen:M,onClose:()=>{j(!1),w(null)},onSubmit:we,product:h,type:"wholesale"}),s.jsx(D,{open:oe,onOpenChange:g?void 0:N,children:s.jsxs(E,{className:"bg-white dark:bg-gray-800 border-0 shadow-xl rounded-lg p-6",children:[s.jsxs(F,{className:"text-center",children:[s.jsx("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100 dark:bg-red-900/30 mb-4",children:s.jsx(P,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),s.jsx(A,{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"تأكيد الحذف"}),s.jsxs(I,{className:"mt-2 text-gray-600 dark:text-gray-300",children:["هل أنت متأكد من رغبتك في حذف المنتج"," ",s.jsx("span",{className:"font-semibold text-gray-800 dark:text-white",children:(n==null?void 0:n.name_ar)||(n==null?void 0:n.name)}),"؟",s.jsx("br",{}),s.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium mt-2 inline-block",children:"هذا الإجراء لا يمكن التراجع عنه."})]})]}),s.jsxs(L,{className:"flex flex-row-reverse gap-3 justify-center sm:justify-end",children:[s.jsx(C,{variant:"destructive",onClick:fe,disabled:g,className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-md shadow-sm hover:shadow-md transition-all duration-200 transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",children:g?s.jsxs(s.Fragment,{children:[s.jsx(f,{className:"animate-spin ml-2"}),"جاري الحذف..."]}):"تأكيد الحذف"}),s.jsx(U,{className:"px-6 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 font-medium rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",disabled:g,children:"إلغاء"})]})]})}),s.jsx(D,{open:ce,onOpenChange:v,children:s.jsxs(E,{className:"bg-white dark:bg-gray-800 border-0 shadow-xl rounded-lg p-6",children:[s.jsxs(F,{className:"text-center",children:[s.jsx("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-blue-100 dark:bg-blue-900/30 mb-4",children:s.jsx(te,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),s.jsx(A,{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"نشر المنتج للجملة"}),s.jsx(I,{className:"mt-2 text-gray-600 dark:text-gray-300",children:"هل أنت متأكد من رغبتك في نشر هذا المنتج في قسم الجملة؟"})]}),s.jsxs(L,{className:"flex flex-row-reverse gap-3 justify-center sm:justify-end",children:[s.jsx(C,{onClick:()=>ge("wholesale"),disabled:p,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md shadow-sm hover:shadow-md transition-all duration-200 transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:p?s.jsxs(s.Fragment,{children:[s.jsx(f,{className:"animate-spin ml-2"}),"جاري النشر..."]}):"نشر للجملة"}),s.jsx(U,{className:"px-6 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 font-medium rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",disabled:p,children:"إلغاء"})]})]})}),s.jsx(D,{open:de,onOpenChange:m?void 0:k,children:s.jsxs(E,{className:"bg-white dark:bg-gray-800 border-0 shadow-xl rounded-lg p-6",children:[s.jsxs(F,{className:"text-center",children:[s.jsx("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100 dark:bg-red-900/30 mb-4",children:s.jsx(P,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),s.jsx(A,{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"تأكيد إلغاء النشر"}),s.jsxs(I,{className:"mt-2 text-gray-600 dark:text-gray-300",children:["هل أنت متأكد من رغبتك في إلغاء نشر المنتج"," ",s.jsx("span",{className:"font-semibold text-gray-800 dark:text-white",children:(o==null?void 0:o.name_ar)||(o==null?void 0:o.name)})," ","من واجهة الجملة؟",s.jsx("br",{}),s.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium mt-2 inline-block",children:"لن يظهر المنتج للعملاء بعد الآن."})]})]}),s.jsxs(L,{className:"flex flex-row-reverse gap-3 justify-center sm:justify-end",children:[s.jsx(C,{variant:"destructive",onClick:me,disabled:m,className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-md shadow-sm hover:shadow-md transition-all duration-200 transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",children:m?s.jsxs(s.Fragment,{children:[s.jsx(f,{className:"animate-spin ml-2"}),"جاري الإلغاء..."]}):"تأكيد الإلغاء"}),s.jsx(U,{className:"px-6 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 font-medium rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",disabled:m,children:"إلغاء"})]})]})})]})};export{He as default};
