# تقرير فحص نظام البانرات (Retail & Wholesale)

**تاريخ التقرير:** 25 يوليو 2024

## ملخص تنفيذي

هذا التقرير يقدم فحصاً شاملاً لنظام البانرات الإعلانية في التطبيق. حالياً، يتم عرض البانرات بشكل ثابت (Hardcoded) في الواجهة الأمامية بدون وجود نظام إدارة محتوى (CMS) في لوحة التحكم أو أي دعم من الواجهة الخلفية (Backend). النظام الحالي يفتقر للمرونة والقدرة على التحديث بسهولة، مما يستدعي تطوير حل متكامل.

---

## 1. فحص الواجهة الأمامية (Frontend)

### مكونات البانرات وصفحات العرض

- **مكونات العرض:** يتم استخدام مكون `src/components/Banner.jsx` لعرض بانر فردي، ومكون `src/components/ui/carousel.jsx` لإنشاء عارض صور دوار.
- **صفحات العرض:**
  - **بانرات التجزئة (Retail):** تُعرض في الصفحة الرئيسية `src/pages/HomePage.jsx`.
  - **بانرات الجملة (Wholesale):** تُعرض في الصفحة الرئيسية لعملاء الجملة `src/pages/WholesaleHomePage.jsx`.

### آلية تحديد الجمهور

- يتم تحديد الجمهور **بشكل ضمني** بناءً على الصفحة التي يزورها المستخدم.
  - `HomePage.jsx` تعرض بانرات التجزئة للجميع.
  - `WholesaleHomePage.jsx` تعرض بانرات الجملة، والوصول لهذه الصفحة محمي بواسطة الهوك `useWholesaleAccess` الذي يتأكد من أن المستخدم له دور "الجملة".
- لا يوجد استخدام لـ JWT أو معاملات استعلام (Query Params) لتخصيص البانرات لنفس الجمهور.

### مصدر البيانات

- مصدر البيانات **ثابت (Hardcoded)** داخل ملفات الصفحات نفسها.
  - في `HomePage.jsx`، يتم تعريف مصفوفة `heroBanners`.
  - في `WholesaleHomePage.jsx`، يتم تعريف مصفوفة `wholesaleBanners`.
- **لا يتم جلب بيانات البانرات من أي API خارجي.**

### اعتبارات الوصول والأداء

- **الوصول (Accessibility):**
  - **إيجابي:** يتم استخدام السمة `alt` في الصور، حيث يتم تعيينها من عنوان البانر (`banner.title`).
  - **سلبي:** لا توجد سمات `aria-label` كافية على أزرار التنقل في بعض الأماكن.
- **الأداء (Performance):**
  - **إيجابي:** حاوية عرض البانرات لها ارتفاع ثابت، مما يقلل من حدوث `Cumulative Layout Shift (CLS)`.
  - **سلبي:** الصور لا تستخدم `loading="lazy"`، مما يعني تحميل جميع صور البانرات مع تحميل الصفحة مباشرة، ويؤثر سلباً على سرعة التحميل الأولية.
  - **سلبي:** لا يتم استخدام `srcset` لتوفير صور بأحجام مختلفة للشاشات المختلفة.

---

## 2. فحص لوحة تحكم الإدارة (Admin UI)

- **الحالة:** **غير موجودة.**
- لا توجد أي صفحة أو قسم في لوحة التحكم الحالية (`/admin`) لإضافة أو تعديل أو حذف البانرات.
- تم فحص ملفات المسارات `src/routes/adminRoutes.jsx` وقائمة التنقل `src/components/admin/AdminLayout.jsx` وتأكد عدم وجود أي شيء متعلق بالبانرات.

### اقتراح تصميم مبدئي لواجهة الإدارة

لإضافة هذه الميزة، نقترح إنشاء صفحة جديدة `/admin/banners` تحتوي على:

1.  **جدول لعرض البانرات الحالية** مع أعمدة (الصورة، العنوان، الجمهور، الحالة، تاريخ البدء/الانتهاء، ترتيب العرض).
2.  **زر "إضافة بانر جديد"** يفتح نموذج (modal or new page) بالصيغة التالية:
    - **الجمهور (Audience):** قائمة اختيار (Retail, Wholesale, All).
    - **العنوان (Title):** حقل نصي.
    - **الوصف (Subtitle):** حقل نصي (اختياري).
    - **رابط الصورة (Image URL):** حقل نصي.
    - **النص البديل (Alt Text):** حقل نصي (للوصول).
    - **رابط الوجهة (Link URL):** حقل نصي (عند الضغط على البانر).
    - **فعال (Is Active):** زر تبديل (toggle).
    - **ترتيب العرض (Sort Order):** حقل رقمي.
    - **تاريخ البدء (Starts At):** حقل تاريخ ووقت (اختياري).
    - **تاريخ الانتهاء (Ends At):** حقل تاريخ ووقت (اختياري).

---

## 3. فحص الواجهة الخلفية (Backend)

- **الحالة:** **غير موجودة.**
- بعد فحص شامل لكود الواجهة الخلفية (Go)، لم يتم العثور على أي نقاط نهاية (API Endpoints) أو نماذج (Models) أو جداول قاعدة بيانات متعلقة بالبانرات.

### اقتراح تصميم مبدئي للـ API وقاعدة البيانات

#### API Endpoints

- **`GET /api/banners?audience=[retail|wholesale]`**: لجلب البانرات الفعالة لجمهور معين (Public).
- **`GET /api/admin/banners`**: لجلب كل البانرات للإدارة (Admin Protected).
- **`POST /api/admin/banners`**: لإنشاء بانر جديد (Admin Protected).
- **`PUT /api/admin/banners/:id`**: لتحديث بانر موجود (Admin Protected).
- **`DELETE /api/admin/banners/:id`**: لحذف بانر (Admin Protected).

#### Database Schema

نقترح إنشاء جدول `banners` بالمواصفات التالية:

```sql
CREATE TABLE banners (
    id INT AUTO_INCREMENT PRIMARY KEY,
    audience ENUM('retail', 'wholesale', 'all') NOT NULL DEFAULT 'all',
    title VARCHAR(255) NOT NULL,
    subtitle VARCHAR(255),
    image_url VARCHAR(2048) NOT NULL,
    alt_text VARCHAR(255) NOT NULL,
    link_url VARCHAR(2048),
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    sort_order INT NOT NULL DEFAULT 0,
    starts_at TIMESTAMP NULL,
    ends_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

---

## 4. الجاهزية، الفجوات، والخطوات التالية

### جدول الجاهزية

| الميزة | الحالة | ملاحظات |
| :--- | :--- | :--- |
| عرض بانرات التجزئة | **نعم** | ثابتة في الكود |
| عرض بانرات الجملة | **نعم** | ثابتة في الكود |
| تحديد الجمهور | **نعم** | ضمني حسب الصفحة |
| إدارة البانرات من لوحة التحكم | **لا** | مفقودة بالكامل |
| جلب البانرات من API | **لا** | مفقودة بالكامل |
| جدولة البانرات (تاريخ بدء/انتهاء) | **لا** | مفقودة بالكامل |
| تحسينات الأداء (Lazy Loading) | **لا** | يمكن إضافتها بسهولة |

### الفجوات الرئيسية

1.  **غياب نظام إدارة المحتوى:** لا يمكن لغير المطورين تحديث البانرات.
2.  **غياب الديناميكية:** لا يمكن جدولة البانرات أو تغييرها بدون إعادة نشر (deploy) للواجهة الأمامية.
3.  **صيانة صعبة:** أي تغيير يتطلب تعديل الكود مباشرة.

### الخطوات التالية المقترحة

1.  **تطوير الواجهة الخلفية:** بناء الـ API وإنشاء جدول `banners` في قاعدة البيانات حسب الاقتراح أعلاه.
2.  **تطوير لوحة التحكم:** بناء واجهة المستخدم لإدارة البانرات (CRUD Operations) في قسم الإدارة.
3.  **تحديث الواجهة الأمامية:** تعديل `HomePage.jsx` و `WholesaleHomePage.jsx` لجلب البانرات من الـ API الجديد بدلاً من البيانات الثابتة، مع تطبيق تحسينات الأداء (Lazy Loading).
